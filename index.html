<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ValEd Prep Pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

:root {
  --ink: #0D0F1A;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --surface2: #F0F2FA;
  --border: #E4E6F0;
  --accent: #4F46E5;
  --accent2: #7C3AED;
  --accent-glow: rgba(79,70,229,0.18);
  --green: #059669;
  --green-bg: #ECFDF5;
  --red: #DC2626;
  --red-bg: #FEF2F2;
  --amber: #D97706;
  --amber-bg: #FFFBEB;
  --text: #1E2035;
  --muted: #6B7280;
  --muted2: #9CA3AF;
  --shadow: 0 2px 16px rgba(13,15,26,0.08);
  --shadow-lg: 0 8px 40px rgba(13,15,26,0.12);
  --shadow-accent: 0 8px 32px rgba(79,70,229,0.22);
  --r: 14px;
  --r-sm: 10px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Sora', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.shell { display: flex; min-height: 100vh; }

.sidebar {
  width: 248px;
  background: var(--ink);
  display: flex;
  flex-direction: column;
  padding: 24px 14px;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 100;
  overflow-y: auto;
  transition: transform .28s cubic-bezier(.4,0,.2,1);
}

/* ‚îÄ‚îÄ MOBILE HAMBURGER ‚îÄ‚îÄ */
.mob-topbar {
  display: none;
  position: fixed; top: 0; left: 0; right: 0;
  height: 54px; background: var(--ink);
  align-items: center; padding: 0 16px; gap: 12px;
  z-index: 110; box-shadow: 0 2px 12px rgba(0,0,0,.25);
}
.mob-hamburger {
  background: none; border: none; cursor: pointer;
  display: flex; flex-direction: column; gap: 5px; padding: 4px;
}
.mob-hamburger span {
  display: block; width: 22px; height: 2px;
  background: #fff; border-radius: 2px;
  transition: all .25s;
}
.mob-logo { font-weight: 800; font-size: 16px; color: #fff; }
.mob-overlay {
  display: none; position: fixed; inset: 0;
  background: rgba(0,0,0,.5); z-index: 99;
}
.mob-overlay.on { display: block; }

.logo-wrap {
  display: flex; align-items: center; gap: 11px;
  padding: 4px 10px 22px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  margin-bottom: 24px;
}

.logo-mark {
  width: 38px; height: 38px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 19px;
  box-shadow: 0 4px 16px rgba(79,70,229,0.4);
  flex-shrink: 0;
}

.logo-name { font-weight: 800; font-size: 18px; color: #fff; letter-spacing: -.5px; }
.logo-sub  { font-size: 10px; color: rgba(255,255,255,0.4); font-weight: 500; margin-top: 1px; }

.nav-section-label {
  font-size: 9.5px; font-weight: 700;
  color: rgba(255,255,255,0.3);
  text-transform: uppercase; letter-spacing: 1.2px;
  padding: 0 10px; margin-bottom: 8px;
}

.nav-btn {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 12px; border-radius: var(--r-sm);
  cursor: pointer; font-weight: 500; font-size: 13px;
  color: rgba(255,255,255,0.55);
  background: none; border: none; width: 100%; text-align: left;
  margin-bottom: 2px; transition: all .18s;
}
.nav-btn .ni { font-size: 16px; width: 20px; text-align: center; flex-shrink: 0; }
.nav-btn:hover { background: rgba(255,255,255,0.07); color: rgba(255,255,255,0.9); }
.nav-btn.active {
  background: linear-gradient(135deg, rgba(79,70,229,0.3), rgba(124,58,237,0.2));
  color: #fff;
  font-weight: 600;
  border: 1px solid rgba(79,70,229,0.35);
}

.sidebar-footer {
  margin-top: auto; padding-top: 16px;
  border-top: 1px solid rgba(255,255,255,0.08);
}

.streak-card {
  background: linear-gradient(135deg, #FF6B35, #E8521A);
  border-radius: var(--r-sm); padding: 12px 14px;
  color: white; font-size: 12px; font-weight: 600;
  display: flex; align-items: center; gap: 8px;
}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { margin-left: 248px; padding: 32px; flex: 1; min-height: 100vh; }

/* ‚îÄ‚îÄ PAGE ‚îÄ‚îÄ */
.page { display: none; animation: fadeUp .25s ease; }
.page.on { display: block; }
@keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.page-header { margin-bottom: 28px; }
.page-title { font-size: 26px; font-weight: 800; color: var(--ink); letter-spacing: -.6px; }
.page-sub   { font-size: 13px; color: var(--muted); margin-top: 4px; }

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stats-row { display: grid; grid-template-columns: repeat(4,1fr); gap: 14px; margin-bottom: 24px; }

.stat-card {
  background: var(--surface); border-radius: var(--r);
  padding: 20px 18px; box-shadow: var(--shadow);
  border: 1px solid var(--border); position: relative; overflow: hidden;
}
.stat-card::after {
  content: ''; position: absolute; top: -20px; right: -20px;
  width: 80px; height: 80px; border-radius: 50%; opacity: .08;
}
.stat-card.c1::after { background: var(--accent); }
.stat-card.c2::after { background: var(--green); }
.stat-card.c3::after { background: var(--amber); }
.stat-card.c4::after { background: var(--red); }

.stat-icon { font-size: 22px; margin-bottom: 10px; }
.stat-val  { font-size: 28px; font-weight: 800; color: var(--ink); }
.stat-lbl  { font-size: 11px; color: var(--muted); font-weight: 500; margin-top: 3px; }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card {
  background: var(--surface); border-radius: var(--r);
  padding: 22px; box-shadow: var(--shadow);
  border: 1px solid var(--border);
}
.card-title { font-size: 15px; font-weight: 700; color: var(--ink); margin-bottom: 16px; }

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
.g3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; }

/* ‚îÄ‚îÄ IMPORT ZONE ‚îÄ‚îÄ */
.import-zone {
  border: 2px dashed var(--border);
  border-radius: var(--r);
  padding: 48px 32px;
  text-align: center;
  cursor: pointer;
  transition: all .2s;
  background: var(--bg);
  position: relative;
  overflow: hidden;
}
.import-zone.drag { border-color: var(--accent); background: var(--accent-glow); }
.import-zone:hover { border-color: var(--accent); }

.import-icon { font-size: 48px; margin-bottom: 14px; }
.import-title { font-size: 18px; font-weight: 700; color: var(--ink); margin-bottom: 8px; }
.import-sub   { font-size: 13px; color: var(--muted); margin-bottom: 20px; }
.import-types { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
.type-badge {
  padding: 4px 12px; border-radius: 999px;
  font-size: 11px; font-weight: 600;
  background: var(--surface2); color: var(--muted);
  border: 1px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
}

/* ‚îÄ‚îÄ BTN ‚îÄ‚îÄ */
.btn {
  padding: 10px 22px; border-radius: var(--r-sm);
  font-weight: 600; font-size: 13px; font-family: 'Sora', sans-serif;
  border: none; cursor: pointer; transition: all .18s;
  display: inline-flex; align-items: center; gap: 8px;
}
.btn-accent {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff;
  box-shadow: var(--shadow-accent);
}
.btn-accent:hover { transform: translateY(-1px); box-shadow: 0 12px 40px rgba(79,70,229,0.35); }
.btn-outline { background: var(--surface); color: var(--text); border: 1.5px solid var(--border); }
.btn-outline:hover { border-color: var(--accent); color: var(--accent); }
.btn-lg { padding: 13px 28px; font-size: 15px; border-radius: var(--r); }
.btn-sm { padding: 7px 14px; font-size: 12px; }

/* ‚îÄ‚îÄ PROCESSING ‚îÄ‚îÄ */
.processing-card {
  background: linear-gradient(135deg, rgba(79,70,229,0.05), rgba(124,58,237,0.05));
  border: 2px solid rgba(79,70,229,0.2);
  border-radius: var(--r);
  padding: 32px;
  text-align: center;
}

.spinner {
  width: 48px; height: 48px;
  border: 4px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}
@keyframes spin { to { transform: rotate(360deg); } }

.progress-track { background: var(--border); border-radius: 999px; height: 6px; margin: 16px 0 8px; overflow: hidden; }
.progress-fill  { height: 100%; border-radius: 999px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width .3s ease; }

/* ‚îÄ‚îÄ IMPORT LIST ‚îÄ‚îÄ */
.import-list { display: flex; flex-direction: column; gap: 10px; }

.import-item {
  background: var(--surface); border-radius: var(--r-sm);
  padding: 14px 18px; border: 1px solid var(--border);
  display: flex; align-items: center; gap: 14px;
  box-shadow: var(--shadow);
}
.import-item-icon { font-size: 28px; flex-shrink: 0; }
.import-item-info { flex: 1; }
.import-item-name { font-size: 14px; font-weight: 600; color: var(--ink); }
.import-item-meta { font-size: 11px; color: var(--muted); margin-top: 3px; }
.import-item-badge {
  padding: 4px 12px; border-radius: 999px; font-size: 11px; font-weight: 600;
}
.badge-done    { background: var(--green-bg); color: var(--green); }
.badge-process { background: var(--amber-bg); color: var(--amber); }
.badge-err     { background: var(--red-bg);   color: var(--red);   }

/* ‚îÄ‚îÄ SUBJECT CARDS ‚îÄ‚îÄ */
.subj-card {
  background: var(--surface); border-radius: var(--r);
  padding: 22px; box-shadow: var(--shadow);
  cursor: pointer; transition: all .2s;
  border: 1.5px solid var(--border);
}
.subj-card:hover { box-shadow: var(--shadow-accent); transform: translateY(-2px); border-color: var(--accent); }
.subj-icon  { font-size: 34px; margin-bottom: 10px; }
.subj-name  { font-size: 14px; font-weight: 700; color: var(--ink); margin-bottom: 3px; }
.subj-count { font-size: 11px; color: var(--muted); }
.prog-bg    { background: var(--surface2); border-radius: 999px; height: 5px; overflow: hidden; margin-top: 12px; }
.prog-fill  { height: 100%; border-radius: 999px; }

/* ‚îÄ‚îÄ FLASHCARD ‚îÄ‚îÄ */
.pill-row   { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
.pill {
  padding: 5px 14px; border-radius: 999px;
  font-size: 12px; font-weight: 500;
  border: 1.5px solid var(--border);
  background: var(--surface); color: var(--muted);
  cursor: pointer; transition: all .15s;
}
.pill.on, .pill:hover { border-color: var(--accent); background: var(--accent); color: #fff; }

.fc-scene   { width: 100%; height: 340px; perspective: 1200px; margin-bottom: 24px; }
.fc-inner   { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform .65s cubic-bezier(.4,0,.2,1); cursor: pointer; }
.fc-inner.flipped { transform: rotateY(180deg); }
.fc-face    { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: var(--r); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 44px; text-align: center; }
.fc-front   { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 60%, #9333EA 100%); box-shadow: 0 16px 48px rgba(79,70,229,0.3); }
.fc-back    { background: var(--surface); border: 1.5px solid var(--border); transform: rotateY(180deg); box-shadow: var(--shadow-lg); }

.fc-chip    { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.8px; margin-bottom: 16px; padding: 4px 12px; border-radius: 999px; }
.fc-front .fc-chip { background: rgba(255,255,255,0.2); color: rgba(255,255,255,0.9); }
.fc-back  .fc-chip { background: var(--accent-glow); color: var(--accent); }

.fc-q  { font-size: 21px; font-weight: 700; color: #fff; line-height: 1.55; }
.fc-a  { font-size: 18px; font-weight: 600; color: var(--ink); line-height: 1.55; }
.fc-exp-box { margin-top: 14px; font-size: 12px; color: var(--muted); background: var(--surface2); padding: 10px 16px; border-radius: 8px; line-height: 1.6; max-width: 520px; }
.fc-hint { margin-top: 20px; font-size: 11px; color: rgba(255,255,255,0.5); }

.fc-nav { display: flex; align-items: center; justify-content: center; gap: 14px; margin-bottom: 18px; }
.nav-circle {
  width: 44px; height: 44px; border-radius: 50%;
  border: 1.5px solid var(--border); background: var(--surface);
  font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;
  box-shadow: var(--shadow); transition: all .15s;
}
.nav-circle:hover { border-color: var(--accent); color: var(--accent); }
.nav-circle:disabled { opacity: .35; cursor: not-allowed; }
.fc-count { font-size: 13px; font-weight: 600; color: var(--muted); min-width: 70px; text-align: center; }

.rate-row   { display: flex; gap: 12px; justify-content: center; }
.rate-btn   { padding: 9px 22px; border-radius: 999px; border: none; font-weight: 600; font-size: 13px; cursor: pointer; font-family: 'Sora', sans-serif; transition: all .15s; }
.rate-btn:hover { transform: scale(1.05); }
.rb-hard  { background: var(--red-bg);   color: var(--red);   }
.rb-ok    { background: var(--amber-bg); color: var(--amber); }
.rb-easy  { background: var(--green-bg); color: var(--green); }

/* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
.quiz-header { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
.qprog-wrap  { flex: 1; max-width: 400px; }
.qprog-bar   { height: 7px; background: var(--surface2); border-radius: 999px; overflow: hidden; }
.qprog-fill  { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2)); border-radius: 999px; transition: width .4s; }
.qprog-lbl   { font-size: 11px; color: var(--muted); margin-top: 5px; }

.timer-pill {
  padding: 7px 18px; background: var(--surface); border-radius: 999px;
  box-shadow: var(--shadow); font-weight: 800; font-size: 20px;
  min-width: 90px; text-align: center; border: 1.5px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
}
.timer-pill.warn   { color: var(--amber); border-color: var(--amber-bg); }
.timer-pill.danger { color: var(--red); border-color: var(--red-bg); animation: blink .5s infinite alternate; }
@keyframes blink { from{opacity:1} to{opacity:.55} }

.qcard { background: var(--surface); border-radius: var(--r); padding: 28px; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 16px; }
.q-num  { font-size: 11px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
.q-text { font-size: 18px; font-weight: 700; line-height: 1.65; color: var(--ink); }

.choices { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

.choice-btn {
  padding: 15px 18px; border-radius: var(--r-sm);
  border: 1.5px solid var(--border); background: var(--surface);
  text-align: left; cursor: pointer; font-size: 13px; font-weight: 500;
  color: var(--text); display: flex; align-items: center; gap: 12px;
  box-shadow: 0 1px 4px rgba(0,0,0,.04); transition: all .15s;
  font-family: 'Sora', sans-serif;
}
.choice-btn:hover:not(:disabled) { border-color: var(--accent); background: rgba(79,70,229,0.04); color: var(--accent); }
.choice-btn.correct { border-color: var(--green)!important; background: var(--green-bg)!important; color: var(--green)!important; }
.choice-btn.wrong   { border-color: var(--red)!important;   background: var(--red-bg)!important;   color: var(--red)!important;   }
.choice-btn:disabled { cursor: default; }

.choice-letter {
  width: 28px; height: 28px; border-radius: 50%;
  background: var(--surface2); display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 11px; flex-shrink: 0;
}
.choice-btn.correct .choice-letter { background: var(--green); color: #fff; }
.choice-btn.wrong   .choice-letter { background: var(--red);   color: #fff; }

.expl-box {
  background: rgba(79,70,229,0.05); border-left: 3px solid var(--accent);
  border-radius: 0 var(--r-sm) var(--r-sm) 0;
  padding: 14px 18px; margin-top: 14px;
  font-size: 13px; color: var(--text); display: none; line-height: 1.6;
}
.expl-box.on { display: block; animation: fadeUp .25s ease; }
.qa-row { display: flex; justify-content: flex-end; margin-top: 14px; }

/* ‚îÄ‚îÄ SCORES ‚îÄ‚îÄ */
.score-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; margin-bottom: 22px; }
.score-stat { background: var(--surface); border-radius: var(--r); padding: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); text-align: center; }
.ss-v { font-size: 30px; font-weight: 800; }
.ss-l { font-size: 11px; color: var(--muted); margin-top: 3px; }

.history-list { display: flex; flex-direction: column; gap: 10px; }
.history-item {
  background: var(--surface); border-radius: var(--r-sm); padding: 16px 20px;
  border: 1px solid var(--border); box-shadow: var(--shadow);
  display: flex; align-items: center; gap: 14px;
}
.hist-rank { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; flex-shrink: 0; }
.hist-rank.hi  { background: var(--green-bg); color: var(--green); }
.hist-rank.mid { background: var(--amber-bg); color: var(--amber); }
.hist-rank.lo  { background: var(--red-bg);   color: var(--red);   }
.hist-info { flex: 1; }
.hist-title { font-size: 14px; font-weight: 600; }
.hist-meta  { font-size: 11px; color: var(--muted); margin-top: 2px; }
.hist-pct   { font-size: 22px; font-weight: 800; }

/* ‚îÄ‚îÄ ADD FORM ‚îÄ‚îÄ */
.form-group  { margin-bottom: 16px; }
.form-label  { font-size: 12px; font-weight: 600; color: var(--text); display: block; margin-bottom: 6px; }
.form-ctrl   { width: 100%; padding: 10px 14px; border: 1.5px solid var(--border); border-radius: var(--r-sm); font-size: 13px; font-family: 'Sora', sans-serif; color: var(--text); outline: none; background: var(--surface2); transition: border-color .15s; }
.form-ctrl:focus { border-color: var(--accent); background: var(--surface); }
textarea.form-ctrl { resize: vertical; min-height: 76px; }
.choice-inputs-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.ci-wrap { display: flex; gap: 8px; align-items: center; }
.ci-lbl  { width: 26px; height: 26px; border-radius: 50%; background: var(--accent); color: #fff; font-weight: 700; font-size: 11px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

.q-list   { display: flex; flex-direction: column; gap: 8px; max-height: 480px; overflow-y: auto; }
.q-item   { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--r-sm); padding: 10px 14px; display: flex; align-items: center; gap: 10px; }
.q-item-t { flex: 1; }
.q-item-q { font-size: 12px; color: var(--text); font-weight: 500; }
.q-item-m { font-size: 10px; color: var(--muted2); margin-top: 2px; }
.del-btn  { width: 26px; height: 26px; border-radius: 50%; border: none; background: var(--red-bg); color: var(--red); cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; transition: all .15s; flex-shrink: 0; }
.del-btn:hover { background: var(--red); color: #fff; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.overlay { display: none; position: fixed; inset: 0; background: rgba(13,15,26,0.6); backdrop-filter: blur(6px); z-index: 200; align-items: center; justify-content: center; }
.overlay.on { display: flex; }
.modal { background: var(--surface); border-radius: 22px; padding: 44px; max-width: 460px; width: 90%; text-align: center; box-shadow: 0 24px 80px rgba(0,0,0,0.25); animation: modalIn .35s cubic-bezier(.34,1.56,.64,1); }
@keyframes modalIn { from{transform:translateY(50px);opacity:0} to{transform:translateY(0);opacity:1} }

.modal-emoji { font-size: 58px; margin-bottom: 14px; }
.modal-title { font-size: 26px; font-weight: 800; color: var(--ink); margin-bottom: 8px; letter-spacing: -.5px; }
.modal-sub   { font-size: 13px; color: var(--muted); margin-bottom: 28px; }

.score-ring { width: 130px; height: 130px; border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
.score-ring-inner { width: 104px; height: 104px; border-radius: 50%; background: var(--surface); display: flex; flex-direction: column; align-items: center; justify-content: center; }
.ring-pct { font-size: 28px; font-weight: 800; color: var(--ink); }
.ring-lbl { font-size: 10px; color: var(--muted2); font-weight: 600; letter-spacing: .5px; }

.result-stats { display: flex; gap: 28px; justify-content: center; margin-bottom: 28px; }
.rs { text-align: center; }
.rs-v { font-size: 24px; font-weight: 800; }
.rs-l { font-size: 11px; color: var(--muted); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 24px; right: 24px;
  background: var(--ink); color: #fff;
  padding: 12px 18px; border-radius: var(--r-sm);
  font-size: 13px; font-weight: 500;
  box-shadow: 0 8px 32px rgba(0,0,0,.25);
  display: none; align-items: center; gap: 10px; z-index: 999;
}
.toast.on { display: flex; animation: toastIn .3s ease; }
@keyframes toastIn { from{transform:translateX(80px);opacity:0} to{transform:translateX(0);opacity:1} }

.chip { display: inline-block; padding: 2px 10px; border-radius: 999px; font-size: 11px; font-weight: 600; background: rgba(79,70,229,0.1); color: var(--accent); }

.empty-state { text-align: center; padding: 52px; color: var(--muted2); }
.empty-icon  { font-size: 44px; margin-bottom: 10px; }
.empty-t     { font-size: 15px; font-weight: 600; color: var(--muted); }
.empty-s     { font-size: 12px; margin-top: 4px; }

/* quiz setup form */
.quiz-setup-card { background: var(--surface); border-radius: var(--r); padding: 28px; box-shadow: var(--shadow); border: 1px solid var(--border); max-width: 520px; }

/* quick actions */
.quick-actions { display: flex; flex-direction: column; gap: 10px; }

/* import progress steps */
.steps { display: flex; flex-direction: column; gap: 8px; margin-top: 16px; text-align: left; }
.step { display: flex; align-items: center; gap: 10px; font-size: 13px; }
.step-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.step-dot.done    { background: var(--green); }
.step-dot.active  { background: var(--accent); animation: dotPulse 1s infinite; }
.step-dot.pending { background: var(--border); }
@keyframes dotPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.5)} }

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 768px) {
  .mob-topbar { display: flex; }
  .sidebar { transform: translateX(-100%); padding-top: 24px; }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0 !important; padding: 70px 16px 32px; }
  .stats-row { grid-template-columns: 1fr 1fr; }
  .g2, .g3 { grid-template-columns: 1fr; }
  .choices { grid-template-columns: 1fr; }
  .score-grid { grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
  .fc-scene { height: 280px; }
  .fc-face { padding: 28px 20px; }
  .fc-q { font-size: 17px; }
  .fc-a { font-size: 15px; }
  .quiz-header { flex-wrap: wrap; gap: 10px; }
  .qprog-wrap { width: 100%; max-width: 100%; }
  .result-stats { gap: 14px; }
  .modal { padding: 28px 20px; }
  .import-zone { padding: 32px 18px; }
  .choice-inputs-grid { grid-template-columns: 1fr; }
  .page-title { font-size: 21px; }
}
</style>
</head>
<body>

<!-- Mobile topbar -->
<div class="mob-topbar">
  <button class="mob-hamburger" onclick="toggleSidebar()" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
  <span class="mob-logo">üìö ValEd Pro</span>
</div>
<div class="mob-overlay" id="mob-overlay" onclick="closeSidebar()"></div>

<div class="shell">

<!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
<aside class="sidebar">
  <div class="logo-wrap">
    <div class="logo-mark">üìö</div>
    <div>
      <div class="logo-name">ValEd Pro</div>
      <div class="logo-sub">Values Education Reviewer</div>
    </div>
  </div>

  <div class="nav-section-label">Study</div>
  <button class="nav-btn active" data-page="dashboard" onclick="go('dashboard')"><span class="ni">üè†</span>Dashboard</button>
  <button class="nav-btn" data-page="import" onclick="go('import')"><span class="ni">üì•</span>Import Files <span style="margin-left:auto;background:linear-gradient(135deg,#4F46E5,#7C3AED);color:#fff;font-size:9px;font-weight:700;padding:2px 7px;border-radius:999px">NEW</span></button>
  <button class="nav-btn" data-page="subjects" onclick="go('subjects')"><span class="ni">üìÇ</span>Subjects</button>
  <button class="nav-btn" data-page="flashcards" onclick="go('flashcards')"><span class="ni">üÉè</span>Flashcards</button>
  <button class="nav-btn" data-page="quiz" onclick="go('quiz')"><span class="ni">‚úèÔ∏è</span>Quiz Mode</button>

  <div class="nav-section-label" style="margin-top:12px">Progress</div>
  <button class="nav-btn" data-page="scores" onclick="go('scores')"><span class="ni">üìä</span>My Scores</button>
  <button class="nav-btn" data-page="add" onclick="go('add')"><span class="ni">‚ûï</span>Add Questions</button>

  <div class="sidebar-footer">
    <div class="streak-card">üî• Keep studying ‚Äî you've got this!</div>
  </div>
</aside>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
<main class="main">

<!-- DASHBOARD -->
<div id="pg-dashboard" class="page on">
  <div class="page-header">
    <div class="page-title">Good day! üëã</div>
    <div class="page-sub">Your Values Education board exam reviewer ‚Äî powered by AI</div>
  </div>
  <div class="stats-row">
    <div class="stat-card c1"><div class="stat-icon">üìù</div><div class="stat-val" id="st-total">0</div><div class="stat-lbl">Total Questions</div></div>
    <div class="stat-card c2"><div class="stat-icon">‚úÖ</div><div class="stat-val" id="st-correct">0</div><div class="stat-lbl">Correct Answers</div></div>
    <div class="stat-card c3"><div class="stat-icon">üéØ</div><div class="stat-val" id="st-acc">‚Äî</div><div class="stat-lbl">Accuracy Rate</div></div>
    <div class="stat-card c4"><div class="stat-icon">üÉè</div><div class="stat-val" id="st-flash">0</div><div class="stat-lbl">Cards Reviewed</div></div>
  </div>
  <div class="g2">
    <div class="card">
      <div class="card-title">üöÄ Quick Start</div>
      <div class="quick-actions">
        <button class="btn btn-accent btn-lg" style="width:100%" onclick="go('import')">üì• Import PDF / Document</button>
        <button class="btn btn-accent btn-lg" style="width:100%;background:linear-gradient(135deg,#059669,#047857)" onclick="go('flashcards')">üÉè Start Flashcards</button>
        <button class="btn btn-outline btn-lg" style="width:100%" onclick="go('quiz')">‚úèÔ∏è Take a Quiz</button>
      </div>
    </div>
    <div class="card">
      <div class="card-title">üìå Study Topics</div>
      <div id="db-topics" style="display:flex;flex-direction:column;gap:8px;"></div>
    </div>
  </div>
</div>

<!-- IMPORT -->
<div id="pg-import" class="page">
  <div class="page-header">
    <div class="page-title">üì• Import Files</div>
    <div class="page-sub">Upload your reviewers ‚Äî AI will extract questions automatically</div>
  </div>

  <!-- API Key input -->
  <div class="card" style="margin-bottom:20px;border:1.5px solid rgba(79,70,229,0.3);background:rgba(79,70,229,0.03)">
    <div class="card-title" style="margin-bottom:10px">üîë Gemini API Key</div>
    <div style="font-size:12px;color:var(--muted);margin-bottom:10px">Required for AI question extraction. Your key is never stored ‚Äî sent directly to Google Gemini.</div>
    <div style="display:flex;gap:10px;align-items:center">
      <input type="password" class="form-ctrl" id="api-key-input" placeholder="AIza..." style="flex:1;font-family:'JetBrains Mono',monospace;font-size:12px">
      <button class="btn btn-outline btn-sm" onclick="toggleApiKeyVis()">üëÅ Show</button>
    </div>
  </div>

  <div id="import-dropzone" class="import-zone"
    ondragover="event.preventDefault();this.classList.add('drag')"
    ondragleave="this.classList.remove('drag')"
    ondrop="handleDrop(event)"
    onclick="document.getElementById('file-input').click()">
    <div class="import-icon">üìÑ</div>
    <div class="import-title">Drop your reviewer files here</div>
    <div class="import-sub">Or click to browse ‚Äî AI will read and extract questions automatically</div>
    <div class="import-types">
      <span class="type-badge">.PDF</span>
      <span class="type-badge">.TXT</span>
      <span class="type-badge">.DOC (paste text)</span>
    </div>
    <br>
    <button class="btn btn-accent" onclick="event.stopPropagation();document.getElementById('file-input').click()">üìÇ Browse Files</button>
  </div>
  <input type="file" id="file-input" accept=".pdf,.txt,.md" multiple style="display:none" onchange="handleFiles(this.files)">

  <!-- Processing indicator -->
  <div id="processing-wrap" style="display:none;margin-top:20px">
    <div class="processing-card">
      <div class="spinner"></div>
      <div style="font-size:16px;font-weight:700;color:var(--ink)" id="proc-title">Analyzing your document‚Ä¶</div>
      <div style="font-size:13px;color:var(--muted);margin-top:6px" id="proc-sub">Reading content and extracting questions</div>
      <div class="progress-track"><div class="progress-fill" id="proc-bar" style="width:0%"></div></div>
      <div style="font-size:12px;color:var(--muted2);font-family:'JetBrains Mono',monospace" id="proc-pct">0%</div>
      <div class="steps" id="proc-steps"></div>
    </div>
  </div>

  <!-- Paste text fallback -->
  <div class="card" style="margin-top:20px">
    <div class="card-title">‚úçÔ∏è Or Paste Text Directly</div>
    <div style="font-size:13px;color:var(--muted);margin-bottom:14px">Copy text from your reviewer and paste it below ‚Äî AI will extract all questions</div>
    <textarea class="form-ctrl" id="paste-text" placeholder="Paste your reviewer content here‚Ä¶ (questions, choices, topics, notes ‚Äî any format works)" style="min-height:120px"></textarea>
    <div style="display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap">
      <select class="form-ctrl" id="paste-subject" style="max-width:220px">
        <option value="Ethics &amp; Morality">‚öñÔ∏è Ethics &amp; Morality</option>
        <option value="Filipino Values">üáµüá≠ Filipino Values</option>
        <option value="Human Rights">‚úä Human Rights</option>
        <option value="Citizenship &amp; Civic Duty">üèõÔ∏è Citizenship &amp; Civic Duty</option>
        <option value="Character Education">üí° Character Education</option>
        <option value="Social Responsibility">ü§ù Social Responsibility</option>
        <option value="General Values Education">üìö General Values Education</option>
      </select>
      <button class="btn btn-accent" onclick="processPastedText()">ü§ñ Extract Questions with AI</button>
    </div>
  </div>

  <!-- Imported files list -->
  <div id="imported-wrap" style="margin-top:20px;display:none">
    <div style="font-size:15px;font-weight:700;color:var(--ink);margin-bottom:12px">üìã Imported Files</div>
    <div class="import-list" id="imported-list"></div>
  </div>
</div>

<!-- SUBJECTS -->
<div id="pg-subjects" class="page">
  <div class="page-header"><div class="page-title">üìÇ Subjects</div><div class="page-sub">Browse all topics and start studying</div></div>
  <div class="g3" id="subjects-grid"></div>
</div>

<!-- FLASHCARDS -->
<div id="pg-flashcards" class="page">
  <div class="page-header"><div class="page-title">üÉè Flashcards</div><div class="page-sub">Click the card to reveal the answer</div></div>
  <div class="pill-row" id="fc-pills"></div>
  <div class="fc-scene">
    <div class="fc-inner" id="fc-inner" onclick="flipCard()">
      <div class="fc-face fc-front">
        <div class="fc-chip">Question</div>
        <div class="fc-q" id="fc-q">Select a subject above to begin</div>
        <div class="fc-hint">üëÜ Click to reveal answer</div>
      </div>
      <div class="fc-face fc-back">
        <div class="fc-chip">Answer</div>
        <div class="fc-a" id="fc-a">‚Äî</div>
        <div class="fc-exp-box" id="fc-exp" style="display:none"></div>
      </div>
    </div>
  </div>
  <div class="fc-nav">
    <button class="nav-circle" id="fc-prev" onclick="fcPrev()">‚Üê</button>
    <div class="fc-count" id="fc-count">‚Äî</div>
    <button class="nav-circle" id="fc-next" onclick="fcNext()">‚Üí</button>
  </div>
  <div id="rate-area" style="display:none;text-align:center">
    <div style="font-size:12px;color:var(--muted);margin-bottom:10px">How well did you know this?</div>
    <div class="rate-row">
      <button class="rate-btn rb-hard" onclick="rateCard('hard')">üòì Hard</button>
      <button class="rate-btn rb-ok"   onclick="rateCard('ok')">üòê OK</button>
      <button class="rate-btn rb-easy" onclick="rateCard('easy')">üòÑ Easy</button>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div id="pg-quiz" class="page">
  <div class="page-header"><div class="page-title">‚úèÔ∏è Quiz Mode</div><div class="page-sub">Multiple choice with instant feedback and explanations</div></div>
  <div id="quiz-setup" class="quiz-setup-card">
    <div style="font-size:17px;font-weight:700;margin-bottom:18px">Configure Your Quiz</div>
    <div class="form-group"><label class="form-label">Subject</label><select class="form-ctrl" id="qz-subj"></select></div>
    <div class="form-group"><label class="form-label">Number of Questions</label>
      <select class="form-ctrl" id="qz-num"><option value="5">5 questions</option><option value="10" selected>10 questions</option><option value="20">20 questions</option><option value="all">All available</option></select></div>
    <div class="form-group"><label class="form-label">Timer per Question</label>
      <select class="form-ctrl" id="qz-timer"><option value="0">No timer</option><option value="30">30 seconds</option><option value="60" selected>60 seconds</option><option value="90">90 seconds</option></select></div>
    <button class="btn btn-accent btn-lg" style="width:100%;margin-top:6px" onclick="startQuiz()">üöÄ Start Quiz</button>
  </div>

  <div id="quiz-active" style="display:none">
    <div class="quiz-header">
      <div class="qprog-wrap">
        <div class="qprog-bar"><div class="qprog-fill" id="qpf" style="width:0%"></div></div>
        <div class="qprog-lbl" id="qpl">Question 1 of 10</div>
      </div>
      <div class="timer-pill" id="timer-pill" style="display:none">‚è± <span id="timer-v">60</span>s</div>
      <button class="btn btn-outline btn-sm" onclick="endQuiz()" style="margin-left:8px">Quit</button>
    </div>
    <div class="qcard">
      <div class="q-num" id="q-num">Question 1</div>
      <div class="q-text" id="q-text">Loading‚Ä¶</div>
    </div>
    <div class="choices" id="choices-grid"></div>
    <div class="expl-box" id="expl-box"></div>
    <div class="qa-row"><button class="btn btn-accent" id="next-btn" onclick="nextQ()" style="display:none">Next ‚Üí</button></div>
  </div>
</div>

<!-- SCORES -->
<div id="pg-scores" class="page">
  <div class="page-header"><div class="page-title">üìä My Scores</div><div class="page-sub">Track your performance over time</div></div>
  <div class="score-grid">
    <div class="score-stat"><div class="ss-v" id="sc-att" style="color:var(--accent)">0</div><div class="ss-l">Attempted</div></div>
    <div class="score-stat"><div class="ss-v" id="sc-cor" style="color:var(--green)">0</div><div class="ss-l">Correct</div></div>
    <div class="score-stat"><div class="ss-v" id="sc-acc">‚Äî</div><div class="ss-l">Accuracy</div></div>
  </div>
  <div id="history-wrap"></div>
</div>

<!-- ADD -->
<div id="pg-add" class="page">
  <div class="page-header"><div class="page-title">‚ûï Add Questions</div><div class="page-sub">Manually add questions to your bank</div></div>
  <div class="g2">
    <div>
      <div class="card">
        <div class="card-title">New Question</div>
        <div class="form-group"><label class="form-label">Subject</label><select class="form-ctrl" id="nq-s"></select></div>
        <div class="form-group"><label class="form-label">Question</label><textarea class="form-ctrl" id="nq-q" placeholder="Enter your question‚Ä¶"></textarea></div>
        <div class="form-group">
          <label class="form-label">Answer Choices</label>
          <div class="choice-inputs-grid">
            <div class="ci-wrap"><div class="ci-lbl">A</div><input class="form-ctrl" id="nq-a" placeholder="Choice A"></div>
            <div class="ci-wrap"><div class="ci-lbl">B</div><input class="form-ctrl" id="nq-b" placeholder="Choice B"></div>
            <div class="ci-wrap"><div class="ci-lbl">C</div><input class="form-ctrl" id="nq-c" placeholder="Choice C"></div>
            <div class="ci-wrap"><div class="ci-lbl">D</div><input class="form-ctrl" id="nq-d" placeholder="Choice D"></div>
          </div>
        </div>
        <div class="form-group"><label class="form-label">Correct Answer</label>
          <select class="form-ctrl" id="nq-ans"><option>A</option><option>B</option><option>C</option><option>D</option></select></div>
        <div class="form-group"><label class="form-label">Explanation (optional)</label>
          <textarea class="form-ctrl" id="nq-exp" placeholder="Why is this the correct answer?" style="min-height:60px"></textarea></div>
        <button class="btn btn-accent" style="width:100%" onclick="addQ()">‚úÖ Add Question</button>
      </div>
    </div>
    <div>
      <div class="card">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
          <div class="card-title" style="margin-bottom:0">üìã All Questions</div>
          <span class="chip" id="q-badge">0</span>
        </div>
        <div class="q-list" id="q-list"></div>
      </div>
    </div>
  </div>
</div>

</main>
</div>

<!-- RESULTS MODAL -->
<div class="overlay" id="result-overlay">
  <div class="modal">
    <div class="modal-emoji" id="res-emoji">üéâ</div>
    <div class="modal-title" id="res-title">Quiz Complete!</div>
    <div class="modal-sub">Here's how you did:</div>
    <div class="score-ring" id="score-ring">
      <div class="score-ring-inner">
        <div class="ring-pct" id="ring-pct">0%</div>
        <div class="ring-lbl">SCORE</div>
      </div>
    </div>
    <div class="result-stats">
      <div class="rs"><div class="rs-v" id="rs-cor" style="color:var(--green)">0</div><div class="rs-l">Correct</div></div>
      <div class="rs"><div class="rs-v" id="rs-wro" style="color:var(--red)">0</div><div class="rs-l">Wrong</div></div>
      <div class="rs"><div class="rs-v" id="rs-tot">0</div><div class="rs-l">Total</div></div>
    </div>
    <div style="display:flex;gap:12px;justify-content:center">
      <button class="btn btn-outline" onclick="closeResult()">Close</button>
      <button class="btn btn-accent" onclick="closeResult();go('quiz')">Try Again üîÑ</button>
    </div>
  </div>
</div>

<div class="toast" id="toast-el">‚úÖ <span id="toast-msg"></span></div>

<script>
// ‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

function toggleApiKeyVis(){
  const inp=document.getElementById('api-key-input');
  inp.type=inp.type==='password'?'text':'password';
}

// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const SUBJECTS=[
  {name:'Ethics & Morality',icon:'‚öñÔ∏è',color:'#4F46E5'},
  {name:'Filipino Values',icon:'üáµüá≠',color:'#DC2626'},
  {name:'Human Rights',icon:'‚úä',color:'#059669'},
  {name:'Citizenship & Civic Duty',icon:'üèõÔ∏è',color:'#D97706'},
  {name:'Character Education',icon:'üí°',color:'#7C3AED'},
  {name:'Social Responsibility',icon:'ü§ù',color:'#0891B2'},
  {name:'General Values Education',icon:'üìö',color:'#BE185D'},
];

let Q=[
  // ‚ïê‚ïê ETHICS & MORALITY (20 questions) ‚ïê‚ïê
  {id:1,subject:'Ethics & Morality',question:'What is the Golden Rule in ethics?',choices:['Do unto others as you would have them do unto you','Always tell the truth no matter what','Follow the law at all times','Respect authority above all'],answer:0,explanation:'The Golden Rule is a universal moral principle: treat others the way you want to be treated.'},
  {id:2,subject:'Ethics & Morality',question:'Which philosopher is known for the Categorical Imperative?',choices:['Aristotle','John Stuart Mill','Immanuel Kant','Plato'],answer:2,explanation:"Kant's Categorical Imperative: Act only according to maxims you would will to become universal laws."},
  {id:3,subject:'Ethics & Morality',question:'Utilitarianism holds that the best action is one that:',choices:['Follows the strictest moral rules','Produces the greatest good for the greatest number','Respects individual rights above all else','Promotes virtue and character'],answer:1,explanation:'Utilitarianism (Bentham & Mill) judges actions by their outcomes ‚Äî maximizing overall happiness or utility.'},
  {id:4,subject:'Ethics & Morality',question:'Which value refers to treating all people fairly and without bias?',choices:['Loyalty','Justice','Prudence','Fortitude'],answer:1,explanation:'Justice is the moral virtue of consistently giving to God and neighbor what is their due.'},
  {id:5,subject:'Ethics & Morality',question:'The Greek word "ethos" means:',choices:['Action','Character','Value','Philosophy'],answer:1,explanation:'Ethos means character or custom ‚Äî from which the word "ethics" is derived.'},
  {id:6,subject:'Ethics & Morality',question:'Morality is best defined as:',choices:['A set of government laws','The quality of human acts as good, bad, or indifferent','A religious doctrine only','Rules created by society'],answer:1,explanation:'Morality is the standard of behavior by which human acts are judged as good, bad, or morally neutral.'},
  {id:7,subject:'Ethics & Morality',question:'Which ethical theory focuses on developing good character traits?',choices:['Deontology','Utilitarianism','Virtue Ethics','Social Contract Theory'],answer:2,explanation:'Virtue Ethics (Aristotle) focuses on cultivating moral character rather than following rules or calculating outcomes.'},
  {id:8,subject:'Ethics & Morality',question:'The four cardinal virtues are:',choices:['Faith, Hope, Love, Justice','Prudence, Justice, Fortitude, Temperance','Honesty, Humility, Charity, Patience','Wisdom, Courage, Mercy, Truth'],answer:1,explanation:'The four cardinal virtues ‚Äî Prudence, Justice, Fortitude, and Temperance ‚Äî are the foundation of moral living.'},
  {id:9,subject:'Ethics & Morality',question:"Kohlberg's highest stage of moral development involves:",choices:['Obedience to authority','Social conformity','Universal ethical principles','Fear of punishment'],answer:2,explanation:"Kohlberg's Stage 6 (Post-conventional) is guided by universal ethical principles such as justice and human dignity."},
  {id:10,subject:'Ethics & Morality',question:'An act is considered moral if it is done with a good:',choices:['Result only','Intention and proper means','Public image','Legal basis'],answer:1,explanation:'Moral acts require good intention, proper means, and morally acceptable circumstances ‚Äî all three must align.'},
  {id:11,subject:'Ethics & Morality',question:'The "Moral Recovery Program" in the Philippines was designed to:',choices:['Reform the judicial system','Strengthen the moral fiber of Filipino people','Increase government efficiency','Promote economic development'],answer:1,explanation:'The Moral Recovery Program aims to renew and strengthen Filipino values and moral character for national development.'},
  {id:12,subject:'Ethics & Morality',question:'Which of the following best describes a moral dilemma?',choices:['A clear choice between right and wrong','A situation with no solution','A choice between two equally valid moral obligations','A legal problem'],answer:2,explanation:'A moral dilemma involves a conflict between two or more moral obligations where choosing one may violate another.'},
  {id:13,subject:'Ethics & Morality',question:'Conscience in ethics refers to:',choices:["God's direct voice","The mind's ability to judge moral rightness of actions",'Public opinion','Legal standards'],answer:1,explanation:'Conscience is the internal faculty that evaluates whether actions conform to moral law ‚Äî the voice of moral reason.'},
  {id:14,subject:'Ethics & Morality',question:'Natural Law theory holds that morality is based on:',choices:['Government decrees','Human nature and reason','Religious texts alone','Cultural traditions'],answer:1,explanation:'Natural Law (Aquinas) argues that moral norms are grounded in human nature and discoverable through reason.'},
  {id:15,subject:'Ethics & Morality',question:'Which philosopher said "I think, therefore I am"?',choices:['Plato','Aristotle','Ren√© Descartes','Socrates'],answer:2,explanation:'Ren√© Descartes coined "Cogito, ergo sum" ‚Äî establishing the self as the starting point of philosophical inquiry.'},
  {id:16,subject:'Ethics & Morality',question:'Ethical relativism holds that:',choices:['Moral values are universal','Right and wrong are culturally determined','Ethics is only for philosophers','Laws determine morality'],answer:1,explanation:'Ethical relativism argues that moral judgments are relative to culture, society, or individual ‚Äî there are no universal moral truths.'},
  {id:17,subject:'Ethics & Morality',question:'The "ends justify the means" argument is associated with:',choices:['Kantian ethics','Deontology','Consequentialism','Natural Law'],answer:2,explanation:'Consequentialism (including some forms of utilitarianism) judges actions by their outcomes ‚Äî the ends can justify the means.'},
  {id:18,subject:'Ethics & Morality',question:'Respect for persons as ends in themselves, not merely as means, is a principle from:',choices:['Aristotle','Immanuel Kant','Jeremy Bentham','John Locke'],answer:1,explanation:"Kant's second formulation of the Categorical Imperative: always treat humanity as an end, never merely as a means."},
  {id:19,subject:'Ethics & Morality',question:'Which virtue involves controlling one's desires and impulses?',choices:['Justice','Prudence','Fortitude','Temperance'],answer:3,explanation:'Temperance is the virtue of moderation ‚Äî regulating desires, emotions, and behaviors within proper limits.'},
  {id:20,subject:'Ethics & Morality',question:'Ethics is a branch of philosophy that studies:',choices:['Political systems','Human knowledge','Moral values and conduct','The nature of reality'],answer:2,explanation:'Ethics (moral philosophy) is the systematic study of moral values, principles, and the standards of right and wrong conduct.'},

  // ‚ïê‚ïê FILIPINO VALUES (20 questions) ‚ïê‚ïê
  {id:21,subject:'Filipino Values',question:"'Utang na loob' in Filipino culture refers to:",choices:['A sense of gratitude and debt of goodwill','Fear of shame or embarrassment','Group solidarity','Respect for elders'],answer:0,explanation:"Utang na loob (debt of goodwill) involves gratitude and obligation to repay kindness received."},
  {id:22,subject:'Filipino Values',question:"'Hiya' as a Filipino value means:",choices:['Pride and honor','Sense of shame or propriety','Loyalty to family','Patience and endurance'],answer:1,explanation:"Hiya (shame/propriety) motivates Filipinos to maintain social harmony and avoid embarrassment."},
  {id:23,subject:'Filipino Values',question:"'Bayanihan' refers to:",choices:['Individual success','Community spirit and mutual aid','Religious devotion','Respect for authority'],answer:1,explanation:"Bayanihan is the Filipino spirit of communal unity and cooperation ‚Äî helping others without expecting payment."},
  {id:24,subject:'Filipino Values',question:"'Pakikisama' means:",choices:['Getting along well with the group','Avoiding conflict at all costs','Blind obedience','Seeking personal gain'],answer:0,explanation:"Pakikisama means togetherness and group cohesion ‚Äî getting along and maintaining harmony."},
  {id:25,subject:'Filipino Values',question:"'Bahala na' attitude in Filipino culture is often associated with:",choices:['Hard work and diligence','Leaving things to fate or God','Civic engagement','Critical thinking'],answer:1,explanation:"'Bahala na' (come what may) reflects a fatalistic attitude ‚Äî sometimes seen as trust in God, other times as resignation."},
  {id:26,subject:'Filipino Values',question:"'Amor propio' refers to:",choices:['Love of country','Self-esteem and sense of personal dignity','Love of family','Romantic love'],answer:1,explanation:"Amor propio is the Filipino's strong sense of self-esteem and personal dignity ‚Äî closely linked to hiya."},
  {id:27,subject:'Filipino Values',question:"Which Filipino value is described as 'crab mentality'?",choices:['Pulling others down to prevent them from succeeding','Sharing food with neighbors','Helping in times of calamity','Celebrating with the community'],answer:0,explanation:"'Crab mentality' (utak-talangka) is the tendency to undermine or pull down others who are achieving success."},
  {id:28,subject:'Filipino Values',question:"'Damayan' in Filipino culture refers to:",choices:['Competition among neighbors','Mutual aid and sympathy especially in times of grief','Religious ceremony','Community celebration'],answer:1,explanation:"Damayan is the Filipino practice of extending help and sympathy to others, especially during difficult times like death."},
  {id:29,subject:'Filipino Values',question:"'Ma√±ana habit' refers to:",choices:['Waking up early','Procrastination or delaying tasks','Completing work ahead of schedule','Working overtime'],answer:1,explanation:"Ma√±ana habit (from Spanish 'ma√±ana' = tomorrow) is the tendency to postpone tasks ‚Äî a recognized negative Filipino trait."},
  {id:30,subject:'Filipino Values',question:"'Pakikipagkapwa-tao' means:",choices:['Competing with others','Human solidarity and treating others as fellow human beings','Avoiding social interactions','Following rules strictly'],answer:1,explanation:"Pakikipagkapwa-tao is treating others as fellow humans with shared identity ‚Äî the highest Filipino relational value."},
  {id:31,subject:'Filipino Values',question:"The Filipino value of 'Kagandahang-loob' refers to:",choices:['Physical beauty','Inner goodness and graciousness','Bravery in battle','Intellectual ability'],answer:1,explanation:"Kagandahang-loob is inner goodness ‚Äî the beauty of one's soul expressed through kindness and generosity."},
  {id:32,subject:'Filipino Values',question:"'Sipag at tiyaga' represents the Filipino values of:",choices:['Faith and hope','Industry and perseverance','Loyalty and service','Creativity and innovation'],answer:1,explanation:"Sipag at tiyaga (diligence and perseverance) are core Filipino work values essential for success and nation-building."},
  {id:33,subject:'Filipino Values',question:"Which positive Filipino value refers to deep concern for the welfare of others?",choices:['Malasakit','Hiya','Bahala na','Ningas cogon'],answer:0,explanation:"Malasakit is genuine concern and care for others' well-being ‚Äî one of the most valued Filipino traits."},
  {id:34,subject:'Filipino Values',question:"'Ningas cogon' describes a Filipino tendency to:",choices:['Work hard consistently','Start with great enthusiasm but lose interest quickly','Never start any project','Complete all tasks perfectly'],answer:1,explanation:"Ningas cogon refers to initial enthusiasm that quickly fades ‚Äî like cogon grass that burns brightly but briefly."},
  {id:35,subject:'Filipino Values',question:"The Filipino concept of 'kapwa' (shared identity) was developed by psychologist:",choices:['Jose Rizal','Virgilio Enriquez','Nick Joaquin','F. Landa Jocano'],answer:1,explanation:"Dr. Virgilio Enriquez, father of Sikolohiyang Pilipino, developed the concept of 'kapwa' as the core Filipino value."},
  {id:36,subject:'Filipino Values',question:"'Pagmamalasakit sa kalikasan' promotes:",choices:['Economic growth only','Care and responsibility for the natural environment','Urban development','Industrial expansion'],answer:1,explanation:"Pagmamalasakit sa kalikasan is the Filipino value of caring for and being responsible stewards of the natural environment."},
  {id:37,subject:'Filipino Values',question:"'Pagtitiwala' (trust) in Filipino culture is primarily built through:",choices:['Written contracts','Personal relationships and track record','Government certification','Financial ability'],answer:1,explanation:"In Filipino culture, trust is primarily relational ‚Äî built through personal connections, shared experiences, and proven reliability."},
  {id:38,subject:'Filipino Values',question:"The Filipino trait of 'resilience' (lakas ng loob) is best shown when Filipinos:",choices:['Avoid problems','Recover and rebuild after disasters with optimism','Rely on government aid only','Migrate abroad'],answer:1,explanation:"Filipino resilience is the remarkable ability to bounce back from adversity ‚Äî often noted after typhoons and calamities."},
  {id:39,subject:'Filipino Values',question:"'Pagpapahalaga sa pamilya' (family values) in the Philippines means:",choices:['Nuclear family only','Extended family bonds and strong family loyalty','Individual independence from family','Following only parents'],answer:1,explanation:"Filipino family values include strong bonds with the extended family (lolo, lola, tito, tita) and deep sense of family loyalty."},
  {id:40,subject:'Filipino Values',question:"Which Filipino hero is known for saying 'Ang hindi marunong lumingon sa pinanggalingan ay hindi makararating sa paroroonan'?",choices:['Andres Bonifacio','Emilio Aguinaldo','Jose Rizal','Apolinario Mabini'],answer:2,explanation:"This famous quote is attributed to Jose Rizal ‚Äî emphasizing the importance of knowing one's roots to move forward."},

  // ‚ïê‚ïê HUMAN RIGHTS (15 questions) ‚ïê‚ïê
  {id:41,subject:'Human Rights',question:'The Universal Declaration of Human Rights was adopted in:',choices:['1945','1948','1950','1955'],answer:1,explanation:'The UDHR was adopted by the UN General Assembly on December 10, 1948 ‚Äî now Human Rights Day.'},
  {id:42,subject:'Human Rights',question:'Human rights are best described as:',choices:['Granted by government','Universal, inherent, and inalienable','Earned through citizenship','Limited to adults only'],answer:1,explanation:'Human rights are universal (for everyone), inherent (born with them), and inalienable (cannot be permanently removed).'},
  {id:43,subject:'Human Rights',question:'The right to life, liberty, and security of person is found in UDHR Article:',choices:['Article 1','Article 3','Article 18','Article 21'],answer:1,explanation:'UDHR Article 3 guarantees everyone the right to life, liberty, and security of person.'},
  {id:44,subject:'Human Rights',question:'Which Philippine law is the primary Anti-Torture Act?',choices:['RA 7438','RA 9745','RA 9262','RA 10368'],answer:1,explanation:'Republic Act 9745 (Anti-Torture Act of 2009) prohibits torture and other cruel, inhuman, or degrading treatment in the Philippines.'},
  {id:45,subject:'Human Rights',question:'The Commission on Human Rights in the Philippines was established under:',choices:['RA 7438','Executive Order 163','The 1987 Constitution','RA 9745'],answer:2,explanation:'The Commission on Human Rights (CHR) was established under the 1987 Philippine Constitution as an independent constitutional body.'},
  {id:46,subject:'Human Rights',question:'Freedom of expression is limited when it:',choices:['Criticizes the government','Involves unpopular opinions','Constitutes hate speech or incites violence','Disagrees with public norms'],answer:2,explanation:'Freedom of expression has limits ‚Äî it does not protect hate speech, defamation, or speech that incites violence or harm.'},
  {id:47,subject:'Human Rights',question:'The right to education in the Philippines is guaranteed under:',choices:['RA 10533 only','The 1987 Constitution and RA 10533','Executive orders only','Local ordinances'],answer:1,explanation:'The 1987 Constitution guarantees free basic education; RA 10533 (Enhanced Basic Education Act) expanded K-12 implementation.'},
  {id:48,subject:'Human Rights',question:'Which international body monitors compliance with the Convention on the Rights of the Child (CRC)?',choices:['UN Security Council','UN Committee on the Rights of the Child','UNICEF','International Court of Justice'],answer:1,explanation:'The UN Committee on the Rights of the Child monitors how signatory countries implement the CRC obligations.'},
  {id:49,subject:'Human Rights',question:"'CEDAW' stands for:",choices:['Convention Eliminating Discrimination Against Women','Commission on Equal Development and Women','Convention on the Elimination of All Forms of Discrimination Against Women','Committee for Equal Development Among Women'],answer:2,explanation:"CEDAW (1979) is the international bill of rights for women, addressing all forms of discrimination against women globally."},
  {id:50,subject:'Human Rights',question:'The Magna Carta of Women in the Philippines is:',choices:['RA 9262','RA 9710','RA 7877','RA 10364'],answer:1,explanation:'Republic Act 9710 (Magna Carta of Women, 2009) ensures Filipino women are recognized and protected in all sectors.'},
  {id:51,subject:'Human Rights',question:'Which right is considered non-derogable ‚Äî cannot be suspended even in times of emergency?',choices:['Right to travel','Right to vote','Right to life and freedom from torture','Right to free speech'],answer:2,explanation:'Non-derogable rights (right to life, freedom from torture, slavery) cannot be suspended under any circumstance, even during war.'},
  {id:52,subject:'Human Rights',question:'The Anti-Violence Against Women and Children Act is:',choices:['RA 9775','RA 9262','RA 9745','RA 7610'],answer:1,explanation:'RA 9262 (Anti-VAWC Act, 2004) protects women and children from physical, sexual, psychological, and economic abuse.'},
  {id:53,subject:'Human Rights',question:'Human dignity means:',choices:['Being wealthy and powerful','The inherent worth of every person regardless of status','Having good reputation','Following moral laws only'],answer:1,explanation:"Human dignity is the inherent, inalienable worth of every person ‚Äî the foundation of all human rights."},
  {id:54,subject:'Human Rights',question:'RA 7610 in the Philippines protects:',choices:['Elderly citizens','Children against abuse, exploitation, and discrimination','Women from domestic violence','Indigenous peoples'],answer:1,explanation:'RA 7610 (Special Protection of Children Against Abuse, Exploitation and Discrimination Act) safeguards Filipino children.'},
  {id:55,subject:'Human Rights',question:'The principle of "non-discrimination" in human rights means:',choices:['Treating everyone the same in all situations','Rights apply to all without distinction of race, sex, language, or religion','Only citizens have rights','Rights are earned through behavior'],answer:1,explanation:'Non-discrimination is a core human rights principle ‚Äî rights apply to all persons regardless of any characteristic.'},

  // ‚ïê‚ïê CITIZENSHIP & CIVIC DUTY (15 questions) ‚ïê‚ïê
  {id:56,subject:'Citizenship & Civic Duty',question:'A good citizen is best described as one who:',choices:['Pays taxes only','Obeys laws and contributes to society','Avoids politics','Prioritizes personal interests'],answer:1,explanation:"A good citizen obeys laws, participates in civic life, and works for the common good."},
  {id:57,subject:'Citizenship & Civic Duty',question:'The Preamble of the 1987 Philippine Constitution begins with:',choices:['"We, the sovereign Filipino people"','We, the citizens of the Philippines"','"We, the people of the Philippines"','"We, the democratic Filipino nation"'],answer:2,explanation:'The 1987 Constitution Preamble begins: "We, the People of the Philippines, imploring the aid of Almighty God..."'},
  {id:58,subject:'Citizenship & Civic Duty',question:'Suffrage in the Philippines is exercised by citizens who are at least:',choices:['16 years old','18 years old','21 years old','15 years old'],answer:1,explanation:'Under the 1987 Constitution, suffrage is granted to all citizens at least 18 years old who are registered voters.'},
  {id:59,subject:'Citizenship & Civic Duty',question:'Which of the following is a duty of a Filipino citizen under the Constitution?',choices:['Voting in all elections (optional)','Defending the State when needed','Paying only national taxes','Serving in government only'],answer:1,explanation:'Article II, Section 4 of the 1987 Constitution states that it is the duty of citizens to defend the State.'},
  {id:60,subject:'Citizenship & Civic Duty',question:'Civic virtue refers to:',choices:['Physical strength','Qualities that make a person a good member of society','Academic excellence','Following government orders only'],answer:1,explanation:"Civic virtue encompasses the qualities ‚Äî responsibility, participation, respect ‚Äî that make one contribute positively to democratic life."},
  {id:61,subject:'Citizenship & Civic Duty',question:'The concept of "people power" in the Philippines was demonstrated in:',choices:['1972','1986 EDSA Revolution','1998','2001 EDSA II'],answer:1,explanation:'The 1986 People Power Revolution (EDSA I) peacefully ousted Ferdinand Marcos ‚Äî a landmark of Filipino civic action.'},
  {id:62,subject:'Citizenship & Civic Duty',question:'Under Philippine law, citizenship by birth (jus sanguinis) means:',choices:['Born within Philippine territory','Child of a Filipino parent','Naturalized after living in the Philippines','Married to a Filipino citizen'],answer:1,explanation:"The Philippines follows jus sanguinis ‚Äî citizenship is determined by one's parents' citizenship, not place of birth."},
  {id:63,subject:'Citizenship & Civic Duty',question:'The Sangguniang Kabataan (SK) represents:',choices:['Senior citizens','Youth participation in local governance','National youth organizations','Student councils only'],answer:1,explanation:"The SK is the youth council in barangay governance ‚Äî representing Filipino youth aged 15-30 in local decision-making."},
  {id:64,subject:'Citizenship & Civic Duty',question:'Freedom of assembly means citizens have the right to:',choices:['Gather in public places at any time without rules','Peacefully assemble for redress of grievances','Block all public roads during protests','Organize against the government without restrictions'],answer:1,explanation:'Freedom of assembly allows peaceful gathering to express views and seek redress ‚Äî subject to reasonable time, place, and manner rules.'},
  {id:65,subject:'Citizenship & Civic Duty',question:'The barangay is:',choices:['The national government unit','The smallest political unit in the Philippines','A provincial subdivision only','A municipal court'],answer:1,explanation:'The barangay is the smallest and most basic political unit of the Philippine government ‚Äî the foundation of local governance.'},
  {id:66,subject:'Citizenship & Civic Duty',question:'Paying taxes is a civic duty because:',choices:['It is forced by law only','It funds public services and government functions for all','It benefits only the rich','It is required for employment'],answer:1,explanation:'Taxes fund education, health, infrastructure, and public services ‚Äî making tax payment a civic duty that benefits everyone.'},
  {id:67,subject:'Citizenship & Civic Duty',question:'Active citizenship means:',choices:['Obeying laws passively','Participating actively in civic and community affairs','Voting in elections only','Following government programs'],answer:1,explanation:'Active citizenship goes beyond passive compliance ‚Äî it involves engagement, advocacy, volunteerism, and participation in democracy.'},
  {id:68,subject:'Citizenship & Civic Duty',question:'The Freedom of Information (FOI) Executive Order in the Philippines promotes:',choices:['Secrecy in government','Government transparency and citizen access to public information','Media censorship','Restricted press freedom'],answer:1,explanation:'EO 2 (2016) mandates transparency and public access to government information ‚Äî promoting accountability and good governance.'},
  {id:69,subject:'Citizenship & Civic Duty',question:'Nationalism in the Philippine context means:',choices:['Rejection of all foreign influence','Love of country and promotion of Filipino interests and culture','Isolationism from the global community','Superiority over other nations'],answer:1,explanation:"Filipino nationalism involves love of country, pride in Filipino identity, and commitment to the nation's welfare and sovereignty."},
  {id:70,subject:'Citizenship & Civic Duty',question:'Republic Act 9155, the Governance of Basic Education Act, emphasizes:',choices:['Privatization of education','School-based management and community participation','Abolishing local school boards','Centralizing all education decisions'],answer:1,explanation:'RA 9155 decentralizes education governance ‚Äî empowering schools and communities through school-based management.'},

  // ‚ïê‚ïê CHARACTER EDUCATION (12 questions) ‚ïê‚ïê
  {id:71,subject:'Character Education',question:'Integrity means:',choices:['Being smart academically','Acting with honesty even when no one is watching','Following rules only when enforced','Being popular among peers'],answer:1,explanation:"Integrity means adhering to moral principles consistently ‚Äî doing what is right even when unobserved."},
  {id:72,subject:'Character Education',question:'Empathy is best defined as:',choices:['Feeling sorry for someone','Understanding and sharing the feelings of another','Giving money to the poor','Offering advice to others'],answer:1,explanation:"Empathy is the ability to understand and share another person's feelings ‚Äî putting yourself in their shoes."},
  {id:73,subject:'Character Education',question:'Resilience in character education refers to:',choices:['Physical strength','The ability to recover from setbacks and adapt to difficulty','Refusing to accept failure','Ignoring problems'],answer:1,explanation:'Resilience is the capacity to bounce back from adversity, trauma, or challenges ‚Äî an essential life skill for students.'},
  {id:74,subject:'Character Education',question:'Responsibility in character education means:',choices:['Blaming others for problems','Being accountable for one's actions and obligations','Following instructions only','Doing tasks when convenient'],answer:1,explanation:'Responsibility means owning your choices, fulfilling your duties, and being accountable for your actions and their consequences.'},
  {id:75,subject:'Character Education',question:'Honesty involves:',choices:['Telling people what they want to hear','Truthfulness in words and actions','Keeping all information private','Being diplomatic always'],answer:1,explanation:'Honesty is the quality of being truthful, sincere, and free from deceit ‚Äî in both words and actions.'},
  {id:76,subject:'Character Education',question:'Self-discipline in students refers to:',choices:['Obeying teachers always','Controlling impulses and behaviors to achieve goals','Avoiding social activities','Studying only when required'],answer:1,explanation:'Self-discipline is the ability to control one's emotions, behaviors, and desires in pursuit of long-term goals.'},
  {id:77,subject:'Character Education',question:'Respect for others requires:',choices:['Agreeing with everyone','Acknowledging the dignity and worth of each person','Treating everyone identically','Following social hierarchies'],answer:1,explanation:'Respect means honoring the inherent dignity, rights, and perspectives of others ‚Äî even when you disagree with them.'},
  {id:78,subject:'Character Education',question:'Courage in character education includes:',choices:['Physical bravery only','Doing what is right despite fear or opposition','Recklessness and risk-taking','Showing off strength'],answer:1,explanation:"Courage (moral courage) means doing what is right and speaking truth even when it's difficult or unpopular."},
  {id:79,subject:'Character Education',question:'Humility is best described as:',choices:['Low self-esteem','An accurate, modest view of oneself and one's abilities','Refusing compliments','Being submissive to everyone'],answer:1,explanation:"Humility is not thinking less of yourself ‚Äî it's thinking of yourself less. It's an accurate, grounded self-assessment."},
  {id:80,subject:'Character Education',question:'Which character trait helps students persist through academic challenges?',choices:['Conformity','Grit and perseverance','Popularity','Perfectionism'],answer:1,explanation:"Grit (Angela Duckworth's concept) ‚Äî passion and perseverance for long-term goals ‚Äî is a key predictor of academic success."},
  {id:81,subject:'Character Education',question:'Fairness in character education means:',choices:['Giving everyone the same thing','Treating people justly according to their needs and merit','Favoring friends and family','Following only written rules'],answer:1,explanation:'Fairness involves treating people equitably ‚Äî considering individual needs, not just giving identical treatment to everyone.'},
  {id:82,subject:'Character Education',question:'Compassion differs from empathy in that compassion:',choices:['Is only feeling what others feel','Involves action to help alleviate suffering','Requires no emotional connection','Is limited to close relationships'],answer:1,explanation:"Empathy is feeling with others; compassion goes further ‚Äî it motivates action to help relieve another's suffering."},

  // ‚ïê‚ïê SOCIAL RESPONSIBILITY (12 questions) ‚ïê‚ïê
  {id:83,subject:'Social Responsibility',question:'Environmental stewardship means:',choices:['Using all natural resources freely','Taking care of and protecting the environment','Prioritizing economic gain over nature','Leaving environmental issues to government'],answer:1,explanation:"Environmental stewardship is the responsible use and protection of nature through conservation."},
  {id:84,subject:'Social Responsibility',question:"The 'common good' refers to:",choices:['What benefits only the majority','Shared public facilities','Conditions that allow people and communities to flourish','Individual freedom without limits'],answer:2,explanation:"The common good refers to conditions allowing people ‚Äî as individuals or groups ‚Äî to reach their fulfillment."},
  {id:85,subject:'Social Responsibility',question:'Corporate Social Responsibility (CSR) means businesses:',choices:['Maximize profit at all costs','Contribute positively to society beyond legal obligations','Pay taxes only','Follow only labor laws'],answer:1,explanation:'CSR is a business model where companies integrate social, environmental, and ethical concerns into their operations voluntarily.'},
  {id:86,subject:'Social Responsibility',question:'Volunteerism promotes:',choices:['Paid community service','Free contribution of time and skills for community benefit','Government-mandated work','Personal advancement only'],answer:1,explanation:'Volunteerism is the practice of freely giving time, skills, or resources to benefit others without monetary compensation.'},
  {id:87,subject:'Social Responsibility',question:'Sustainable development means:',choices:['Development that benefits only the current generation','Meeting present needs without compromising future generations','Unlimited economic growth','Industrial development at any cost'],answer:1,explanation:"Sustainable development (Brundtland Commission, 1987) meets today's needs without compromising future generations' ability to meet theirs."},
  {id:88,subject:'Social Responsibility',question:'Social justice requires:',choices:['Equal outcomes for all people','Fair distribution of wealth, opportunities, and privileges in society','Elimination of all social classes','Government control of all resources'],answer:1,explanation:'Social justice calls for equitable distribution of resources, opportunities, and rights ‚Äî addressing systemic inequalities.'},
  {id:89,subject:'Social Responsibility',question:'The principle of subsidiarity in social teaching means:',choices:['Central government controls everything','Decisions should be made at the lowest competent level','Only experts make decisions','Communities have no role in governance'],answer:1,explanation:"Subsidiarity holds that matters should be handled by the smallest, most local authority possible ‚Äî not centralized unnecessarily."},
  {id:90,subject:'Social Responsibility',question:'Civic engagement includes:',choices:['Avoiding public affairs','Voting, volunteering, and participating in community problem-solving','Political party membership only','Following news only'],answer:1,explanation:"Civic engagement encompasses all ways citizens participate in public life ‚Äî voting, volunteering, advocacy, and community service."},
  {id:91,subject:'Social Responsibility',question:'The Philippine Solid Waste Management Act (RA 9003) requires:',choices:['Burning all waste','Segregation of waste at source','Government-only responsibility for waste','Burying all waste in landfills'],answer:1,explanation:"RA 9003 mandates waste segregation at source, recycling, and ecological solid waste management ‚Äî everyone's responsibility."},
  {id:92,subject:'Social Responsibility',question:'Philanthropy in social responsibility means:',choices:['Government welfare programs','Voluntary giving of money or resources for social good','Mandatory corporate donations','Business profit sharing'],answer:1,explanation:'Philanthropy is voluntary charitable giving ‚Äî using personal or organizational resources to benefit society and address social needs.'},
  {id:93,subject:'Social Responsibility',question:'Digital citizenship responsibility includes:',choices:['Sharing all personal information freely','Ethical, safe, and responsible use of technology and online spaces','Unrestricted online behavior','Avoiding all social media'],answer:1,explanation:'Digital citizenship means using technology responsibly, ethically, and safely ‚Äî respecting others and yourself online.'},
  {id:94,subject:'Social Responsibility',question:'The Universal Precautionary Principle in environmental responsibility means:',choices:['Wait for full proof of harm before acting','Take preventive action against environmental threats even under uncertainty','Only scientists decide environmental policy','Economic growth always takes priority'],answer:1,explanation:'The Precautionary Principle holds that when activities raise threats to health or environment, preventive action should be taken even without full scientific certainty.'},

  // ‚ïê‚ïê GENERAL VALUES EDUCATION (12 questions) ‚ïê‚ïê
  {id:95,subject:'General Values Education',question:'Values Education in the Philippines curriculum aims to:',choices:['Teach only religious values','Form morally responsible, socially aware, and spiritually grounded citizens','Replace academic subjects','Promote one culture only'],answer:1,explanation:"Values Education (ValEd) in DepEd aims to develop well-rounded Filipinos who are morally upright, socially responsible, and nationally committed."},
  {id:96,subject:'General Values Education',question:'The DECS Values Conceptual Framework is grounded on:',choices:['Political ideology','Philosophy of the human person in Filipino historical and cultural context','Economic theories','Religious doctrine alone'],answer:1,explanation:"The DepEd/DECS ValEd framework is rooted in understanding the Filipino person in their cultural, historical, and social context."},
  {id:97,subject:'General Values Education',question:'Values clarification as a teaching strategy in ValEd:',choices:['Imposes values on students','Helps students examine, choose, and affirm their own values','Avoids discussion of values','Tests memorization of value lists'],answer:1,explanation:'Values clarification (Raths, Harmin, Simon) helps students freely choose, prize, and act on their personal values through reflection.'},
  {id:98,subject:'General Values Education',question:'The affective domain in values education focuses on:',choices:['Knowledge and facts','Feelings, attitudes, and values','Physical skills','Test performance'],answer:1,explanation:"Bloom's affective domain covers emotions, attitudes, and values ‚Äî the heart of ValEd alongside cognitive and psychomotor learning."},
  {id:99,subject:'General Values Education',question:'A values education teacher's primary role is to:',choices:['Impose correct values on students','Facilitate student discovery and development of values','Test students on value definitions','Create strict behavioral rules'],answer:1,explanation:'ValEd teachers are facilitators ‚Äî creating conditions for students to explore, reflect on, and develop their own value systems.'},
  {id:100,subject:'General Values Education',question:'Moral development according to Lawrence Kohlberg has how many stages?',choices:['3 stages','4 stages','6 stages','8 stages'],answer:2,explanation:"Kohlberg's Theory of Moral Development has 6 stages in 3 levels: Pre-conventional, Conventional, and Post-conventional."},
  {id:101,subject:'General Values Education',question:'The experiential learning process in ValEd begins with:',choices:['Reflection','Experience (activity)','Generalization','Application'],answer:1,explanation:'Experiential learning (David Kolb) starts with concrete experience, then reflective observation, abstract conceptualization, and active experimentation.'},
  {id:102,subject:'General Values Education',question:'Which approach to values education uses real-life stories and dilemmas?',choices:['Rote memorization','Moral dilemma discussion (Kohlberg approach)','Lecture method only','Behavioral conditioning'],answer:1,explanation:"Kohlberg's moral dilemma approach uses real or hypothetical ethical situations to stimulate higher moral reasoning in students."},
  {id:103,subject:'General Values Education',question:'Integrated values education means:',choices:['Separate ValEd classes only','Embedding values across all subject areas','Teaching values only in religion class','Values are covered in MAPEH only'],answer:1,explanation:'Integrated ValEd weaves values formation across all subjects ‚Äî math, science, Filipino, English ‚Äî not just in standalone ValEd classes.'},
  {id:104,subject:'General Values Education',question:'The Preamble of the 1987 Philippine Constitution mentions which core values?',choices:['Democracy and freedom only','Justice, peace, love, equality, independence, and democracy','Efficiency and progress','Order and discipline'],answer:1,explanation:"The Philippine Constitution's Preamble enshrines the values of truth, justice, freedom, love, equality, and peace as national aspirations."},
  {id:105,subject:'General Values Education',question:'Pro-social behavior in values education refers to:',choices:['Selfish actions','Voluntary actions intended to benefit others and society','Legally required community service','Actions done for rewards only'],answer:1,explanation:'Pro-social behavior includes helping, sharing, cooperating, and volunteering ‚Äî actions that benefit others and build community.'},
  {id:106,subject:'General Values Education',question:'Which of the following best describes holistic character formation?',choices:['Focusing on academic excellence alone','Developing the whole person: intellectual, moral, social, emotional, and spiritual','Training only social skills','Enforcing strict behavioral rules'],answer:1,explanation:'Holistic character formation addresses the complete person ‚Äî cognitive, affective, behavioral, social, and spiritual dimensions together.'},
];

let nxtId=107, curFlashSubj=null, flashDeck=[], flashIdx=0, isFlipped=false;
let qzQs=[], qzIdx=0, qzScore=0, isAnswered=false, qzTimer=null, qzTimerSecs=0;
let stats={correct:0,attempted:0,flashReviewed:0}, scores=[], importedFiles=[];

const shuf=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;};

// ‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê
function go(page){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('pg-'+page).classList.add('on');
  const nb=document.querySelector(`[data-page="${page}"]`);
  if(nb)nb.classList.add('active');
  if(page==='dashboard')renderDash();
  if(page==='subjects')renderSubjects();
  if(page==='flashcards')initFlash();
  if(page==='quiz')initQuizSetup();
  if(page==='scores')renderScores();
  if(page==='add')renderAddPage();
}

// ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê
function renderDash(){
  document.getElementById('st-total').textContent=Q.length;
  document.getElementById('st-correct').textContent=stats.correct;
  document.getElementById('st-acc').textContent=stats.attempted>0?Math.round((stats.correct/stats.attempted)*100)+'%':'‚Äî';
  document.getElementById('st-flash').textContent=stats.flashReviewed;
  document.getElementById('db-topics').innerHTML=SUBJECTS.map(s=>`
    <div onclick="curFlashSubj='${s.name}';go('flashcards')" style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--surface2);border-radius:8px;cursor:pointer;border:1px solid var(--border);transition:all .15s" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
      <span style="font-size:17px">${s.icon}</span>
      <div style="flex:1;font-size:12px;font-weight:600">${s.name}</div>
      <span class="chip">${Q.filter(q=>q.subject===s.name).length} Q</span>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê SUBJECTS ‚ïê‚ïê‚ïê
function renderSubjects(){
  document.getElementById('subjects-grid').innerHTML=SUBJECTS.map(s=>{
    const c=Q.filter(q=>q.subject===s.name).length;
    return`<div class="subj-card" onclick="curFlashSubj='${s.name}';go('flashcards')">
      <div class="subj-icon">${s.icon}</div>
      <div class="subj-name">${s.name}</div>
      <div class="subj-count">${c} question${c!==1?'s':''}</div>
      <div class="prog-bg"><div class="prog-fill" style="width:${Math.min(c*7,100)}%;background:${s.color}"></div></div>
      <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--muted2);margin-top:5px"><span>${c} Qs</span><span>Study ‚Üí</span></div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê FLASHCARDS ‚ïê‚ïê‚ïê
function initFlash(){
  const pills=['All',...SUBJECTS.map(s=>s.name)];
  document.getElementById('fc-pills').innerHTML=pills.map(n=>`
    <button class="pill ${(curFlashSubj===n||(n==='All'&&!curFlashSubj))?'on':''}"
      onclick="curFlashSubj='${n==='All'?'':n}';document.querySelectorAll('#fc-pills .pill').forEach(p=>p.classList.remove('on'));this.classList.add('on');loadFlash()">${n}</button>`).join('');
  loadFlash();
}

function loadFlash(){
  flashDeck=curFlashSubj?shuf(Q.filter(q=>q.subject===curFlashSubj)):shuf([...Q]);
  flashIdx=0;isFlipped=false;
  document.getElementById('fc-inner').classList.remove('flipped');
  document.getElementById('rate-area').style.display='none';
  updateFlashcard();
}

function updateFlashcard(){
  if(!flashDeck.length){
    document.getElementById('fc-q').textContent='No questions in this subject yet. Import a file or add questions!';
    document.getElementById('fc-a').textContent='‚Äî';
    document.getElementById('fc-count').textContent='0 / 0';
    return;
  }
  const q=flashDeck[flashIdx];
  document.getElementById('fc-q').textContent=q.question;
  document.getElementById('fc-a').textContent=q.choices[q.answer];
  const expEl=document.getElementById('fc-exp');
  if(q.explanation){expEl.textContent=q.explanation;expEl.style.display='block';}
  else expEl.style.display='none';
  document.getElementById('fc-count').textContent=(flashIdx+1)+' / '+flashDeck.length;
  document.getElementById('fc-prev').disabled=flashIdx===0;
  document.getElementById('fc-next').disabled=flashIdx===flashDeck.length-1;
  document.getElementById('fc-inner').classList.remove('flipped');
  isFlipped=false;
  document.getElementById('rate-area').style.display='none';
}

function flipCard(){
  isFlipped=!isFlipped;
  document.getElementById('fc-inner').classList.toggle('flipped',isFlipped);
  if(isFlipped){document.getElementById('rate-area').style.display='block';stats.flashReviewed++;}
  else document.getElementById('rate-area').style.display='none';
}

function fcPrev(){if(flashIdx>0){flashIdx--;updateFlashcard();}}
function fcNext(){if(flashIdx<flashDeck.length-1){flashIdx++;updateFlashcard();}}

function rateCard(r){
  toast(r==='easy'?'üòÑ Easy! Great job!':r==='ok'?'üòê OK, keep at it!':'üòì Mark for review ‚Äî practice more');
  if(flashIdx<flashDeck.length-1)fcNext();else toast('üéâ Deck complete!');
}

// ‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê
function initQuizSetup(){
  clearQTimer();
  document.getElementById('quiz-setup').style.display='block';
  document.getElementById('quiz-active').style.display='none';
  document.getElementById('qz-subj').innerHTML='<option value="all">üåê All Subjects (Mixed)</option>'+
    SUBJECTS.map(s=>`<option value="${s.name}">${s.icon} ${s.name}</option>`).join('');
}

function startQuiz(){
  const subj=document.getElementById('qz-subj').value;
  const numQ=document.getElementById('qz-num').value;
  qzTimerSecs=parseInt(document.getElementById('qz-timer').value);
  let pool=subj==='all'?[...Q]:Q.filter(q=>q.subject===subj);
  pool=shuf(pool);
  const num=numQ==='all'?pool.length:Math.min(parseInt(numQ),pool.length);
  if(!pool.length){toast('No questions available for this subject!');return;}
  qzQs=pool.slice(0,num);qzIdx=0;qzScore=0;isAnswered=false;
  document.getElementById('quiz-setup').style.display='none';
  document.getElementById('quiz-active').style.display='block';
  renderQ();
}

function renderQ(){
  const q=qzQs[qzIdx];const tot=qzQs.length;
  isAnswered=false;
  document.getElementById('next-btn').style.display='none';
  document.getElementById('expl-box').classList.remove('on');
  document.getElementById('qpf').style.width=Math.round((qzIdx/tot)*100)+'%';
  document.getElementById('qpl').textContent='Question '+(qzIdx+1)+' of '+tot;
  document.getElementById('q-num').textContent='Question '+(qzIdx+1);
  document.getElementById('q-text').textContent=q.question;
  const L=['A','B','C','D'];
  document.getElementById('choices-grid').innerHTML=q.choices.map((c,i)=>`
    <button class="choice-btn" onclick="pickChoice(${i})">
      <div class="choice-letter">${L[i]}</div><span>${c}</span>
    </button>`).join('');
  clearQTimer();
  const tp=document.getElementById('timer-pill');
  if(qzTimerSecs>0){
    tp.style.display='block';tp.className='timer-pill';
    let s=qzTimerSecs;document.getElementById('timer-v').textContent=s;
    qzTimer=setInterval(()=>{
      s--;document.getElementById('timer-v').textContent=s;
      if(s<=10)tp.className='timer-pill danger';else if(s<=20)tp.className='timer-pill warn';
      if(s<=0){clearQTimer();autoFail();}
    },1000);
  }else tp.style.display='none';
}

function pickChoice(idx){
  if(isAnswered)return;
  isAnswered=true;clearQTimer();
  const q=qzQs[qzIdx];
  document.querySelectorAll('.choice-btn').forEach((b,i)=>{
    b.disabled=true;
    if(i===q.answer)b.classList.add('correct');
    else if(i===idx&&idx!==q.answer)b.classList.add('wrong');
  });
  if(idx===q.answer){qzScore++;stats.correct++;}
  stats.attempted++;
  if(q.explanation){const eb=document.getElementById('expl-box');eb.textContent='üí° '+q.explanation;eb.classList.add('on');}
  document.getElementById('next-btn').style.display='block';
}

function autoFail(){
  if(!isAnswered){
    isAnswered=true;stats.attempted++;
    const q=qzQs[qzIdx];
    document.querySelectorAll('.choice-btn').forEach((b,i)=>{b.disabled=true;if(i===q.answer)b.classList.add('correct');});
    const eb=document.getElementById('expl-box');
    eb.textContent="‚è± Time's up! "+(q.explanation?'üí° '+q.explanation:'');
    eb.classList.add('on');
    document.getElementById('next-btn').style.display='block';
  }
}

function nextQ(){qzIdx++;if(qzIdx>=qzQs.length)endQuiz();else renderQ();}

function endQuiz(){
  clearQTimer();
  const tot=qzQs.length;const pct=tot>0?Math.round((qzScore/tot)*100):0;
  const result={score:qzScore,total:tot,pct,subject:document.getElementById('qz-subj').value,date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})};
  scores.unshift(result);
  document.getElementById('res-emoji').textContent=pct>=80?'üéâ':pct>=60?'üòä':'üòì';
  document.getElementById('res-title').textContent=pct>=80?'Excellent Work!':pct>=60?'Good Job!':'Keep Practicing!';
  document.getElementById('ring-pct').textContent=pct+'%';
  document.getElementById('rs-cor').textContent=qzScore;
  document.getElementById('rs-wro').textContent=tot-qzScore;
  document.getElementById('rs-tot').textContent=tot;
  const col=pct>=80?'#059669':pct>=60?'#D97706':'#DC2626';
  document.getElementById('score-ring').style.background=`conic-gradient(${col} ${pct}%,#E4E6F0 0%)`;
  document.getElementById('result-overlay').classList.add('on');
  document.getElementById('quiz-setup').style.display='block';
  document.getElementById('quiz-active').style.display='none';
}

function closeResult(){document.getElementById('result-overlay').classList.remove('on');}
function clearQTimer(){if(qzTimer){clearInterval(qzTimer);qzTimer=null;}}

// ‚ïê‚ïê‚ïê SCORES ‚ïê‚ïê‚ïê
function renderScores(){
  document.getElementById('sc-att').textContent=stats.attempted;
  document.getElementById('sc-cor').textContent=stats.correct;
  const acc=stats.attempted>0?Math.round((stats.correct/stats.attempted)*100)+'%':'‚Äî';
  const el=document.getElementById('sc-acc');
  el.textContent=acc;
  el.style.color=stats.attempted===0?'var(--muted2)':parseInt(acc)>=75?'var(--green)':'var(--red)';
  const hw=document.getElementById('history-wrap');
  if(!scores.length){
    hw.innerHTML='<div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-t">No quiz results yet</div><div class="empty-s">Complete a quiz to see your scores here</div></div>';
    return;
  }
  hw.innerHTML=`<div style="font-size:15px;font-weight:700;margin-bottom:12px">üèÜ Quiz History</div>
  <div class="history-list">${scores.map((s,i)=>{
    const cls=s.pct>=80?'hi':s.pct>=60?'mid':'lo';
    const col=s.pct>=80?'var(--green)':s.pct>=60?'var(--amber)':'var(--red)';
    return`<div class="history-item">
      <div class="hist-rank ${cls}">#${i+1}</div>
      <div class="hist-info">
        <div class="hist-title">${s.subject==='all'?'üåê Mixed Subjects':s.subject} Quiz</div>
        <div class="hist-meta">${s.score}/${s.total} correct ¬∑ ${s.date}</div>
      </div>
      <div class="hist-pct" style="color:${col}">${s.pct}%</div>
    </div>`;
  }).join('')}</div>`;
}

// ‚ïê‚ïê‚ïê ADD QUESTION ‚ïê‚ïê‚ïê
function renderAddPage(){
  document.getElementById('nq-s').innerHTML=SUBJECTS.map(s=>`<option value="${s.name}">${s.icon} ${s.name}</option>`).join('');
  document.getElementById('q-badge').textContent=Q.length;
  const list=document.getElementById('q-list');
  if(!Q.length){list.innerHTML='<div class="empty-state" style="padding:32px"><div class="empty-icon" style="font-size:32px">üì≠</div><div class="empty-t">No questions yet</div></div>';return;}
  list.innerHTML=[...Q].reverse().map(q=>`
    <div class="q-item">
      <div class="q-item-t">
        <div class="q-item-q">${q.question.substring(0,60)}${q.question.length>60?'‚Ä¶':''}</div>
        <div class="q-item-m">üìÇ ${q.subject} ¬∑ ‚úÖ ${q.choices[q.answer]}</div>
      </div>
      <button class="del-btn" onclick="delQ(${q.id})">‚úï</button>
    </div>`).join('');
}

function addQ(){
  const s=document.getElementById('nq-s').value;
  const question=document.getElementById('nq-q').value.trim();
  const a=document.getElementById('nq-a').value.trim();
  const b=document.getElementById('nq-b').value.trim();
  const c=document.getElementById('nq-c').value.trim();
  const d=document.getElementById('nq-d').value.trim();
  const ans=document.getElementById('nq-ans').value;
  const exp=document.getElementById('nq-exp').value.trim();
  if(!question||!a||!b||!c||!d){toast('‚ö†Ô∏è Please fill in all fields!');return;}
  Q.push({id:nxtId++,subject:s,question,choices:[a,b,c,d],answer:{A:0,B:1,C:2,D:3}[ans],explanation:exp});
  document.getElementById('nq-q').value='';
  ['nq-a','nq-b','nq-c','nq-d','nq-exp'].forEach(id=>document.getElementById(id).value='');
  renderAddPage();
  toast('‚úÖ Question added!');
}

function delQ(id){Q=Q.filter(q=>q.id!==id);renderAddPage();toast('üóëÔ∏è Question deleted');}

// ‚ïê‚ïê‚ïê FILE IMPORT ‚ïê‚ïê‚ïê
function handleDrop(e){
  e.preventDefault();
  document.getElementById('import-dropzone').classList.remove('drag');
  handleFiles(e.dataTransfer.files);
}

function handleFiles(files){
  for(const file of files){
    if(file.type==='application/pdf')processPDF(file);
    else if(file.type==='text/plain'||file.name.endsWith('.txt')||file.name.endsWith('.md'))processTXT(file);
    else toast('‚ö†Ô∏è Unsupported format. Use PDF or TXT.');
  }
}

async function processPDF(file){
  const item={name:file.name,type:'PDF',status:'processing',count:0};
  importedFiles.push(item);
  updateImportedList();
  showProc('Reading PDF: '+file.name,'Extracting text from pages‚Ä¶',0);

  try{
    const arrayBuffer=await file.arrayBuffer();
    const pdf=await pdfjsLib.getDocument({data:arrayBuffer}).promise;
    let fullText='';
    for(let i=1;i<=pdf.numPages;i++){
      const page=await pdf.getPage(i);
      const tc=await page.getTextContent();
      fullText+=tc.items.map(it=>it.str).join(' ')+'\n';
      setProc(Math.round((i/pdf.numPages)*40),'Reading page '+i+' of '+pdf.numPages+'‚Ä¶');
    }
    item.pageCount=pdf.numPages;
    setProc(40,'Text extracted. Sending to AI‚Ä¶');
    await extractWithAI(fullText, item, document.getElementById('paste-subject').value);
  }catch(err){
    item.status='error';
    updateImportedList();
    hideProc();
    toast('‚ùå Error reading PDF: '+err.message);
  }
}

async function processTXT(file){
  const item={name:file.name,type:'TXT',status:'processing',count:0};
  importedFiles.push(item);
  updateImportedList();
  showProc('Reading file: '+file.name,'Extracting text‚Ä¶',10);
  const text=await file.text();
  setProc(40,'Text extracted. Sending to AI‚Ä¶');
  await extractWithAI(text, item, document.getElementById('paste-subject').value);
}

async function processPastedText(){
  const text=document.getElementById('paste-text').value.trim();
  const subject=document.getElementById('paste-subject').value;
  if(!text){toast('‚ö†Ô∏è Please paste some text first!');return;}
  const item={name:'Pasted Text ('+subject+')',type:'TEXT',status:'processing',count:0};
  importedFiles.push(item);
  updateImportedList();
  showProc('Processing pasted text‚Ä¶','Sending to AI for analysis‚Ä¶',30);
  await extractWithAI(text,item,subject);
  document.getElementById('paste-text').value='';
}

async function extractWithAI(text, item, defaultSubject){
  setProc(50,'AI is analyzing content‚Ä¶','Identifying questions, choices, and answers');
  updateStep(0,'done');updateStep(1,'active');

  const prompt=`You are an expert at extracting exam questions from study materials.

From the text below, extract ALL multiple-choice questions you can find OR generate high-quality multiple-choice questions based on the key concepts, facts, and topics in the text.

IMPORTANT RULES:
- Each question must have exactly 4 choices (A, B, C, D)
- Identify or determine the correct answer
- Add a brief explanation for each answer
- Subject should be one of: Ethics & Morality, Filipino Values, Human Rights, Citizenship & Civic Duty, Character Education, Social Responsibility, General Values Education
- If the text already has questions, extract them. If not, CREATE questions from the content.
- Generate at least 5 questions, up to 20 maximum.
- Make questions clear and educational.

Return ONLY valid JSON array, no other text, no markdown, no backticks:
[
  {
    "subject": "Ethics & Morality",
    "question": "Question text here?",
    "choices": ["Choice A", "Choice B", "Choice C", "Choice D"],
    "answer": 0,
    "explanation": "Brief explanation of the correct answer."
  }
]

The answer field is the 0-based index of the correct choice (0=A, 1=B, 2=C, 3=D).

TEXT TO ANALYZE:
${text.substring(0,8000)}`;

  try{
    setProc(60,'AI is reading your content‚Ä¶','This may take a few seconds');
    updateStep(1,'done');updateStep(2,'active');

    const apiKey=document.getElementById('api-key-input').value.trim();
    if(!apiKey){throw new Error('Please enter your Gemini API key above before importing.');}
    const response=await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({
        contents:[{parts:[{text:prompt}]}],
        generationConfig:{maxOutputTokens:4000,temperature:0.3}
      })
    });

    setProc(80,'Processing AI response‚Ä¶','Importing questions into your library');
    updateStep(2,'done');updateStep(3,'active');

    const data=await response.json();
    if(data.error){throw new Error(data.error.message||JSON.stringify(data.error));}
    if(!data.candidates||!data.candidates[0]){throw new Error('No response from Gemini.');}

    const raw=data.candidates[0].content.parts[0].text;
    let parsed;
    try{
      // Try to find JSON array in response
      const match=raw.match(/\[[\s\S]*\]/);
      parsed=JSON.parse(match?match[0]:raw);
    }catch(e){
      throw new Error('AI response could not be parsed as JSON.');
    }

    if(!Array.isArray(parsed)||!parsed.length){throw new Error('No questions found in AI response.');}

    let count=0;
    for(const q of parsed){
      if(q.question&&Array.isArray(q.choices)&&q.choices.length===4&&typeof q.answer==='number'){
        Q.push({
          id:nxtId++,
          subject:q.subject||defaultSubject,
          question:q.question,
          choices:q.choices,
          answer:Math.min(Math.max(q.answer,0),3),
          explanation:q.explanation||''
        });
        count++;
      }
    }

    item.status='done';
    item.count=count;
    setProc(100,'Done! '+count+' questions imported','Added to your question bank');
    updateStep(3,'done');

    setTimeout(()=>{
      hideProc();
      updateImportedList();
      renderDash();
      toast('‚úÖ '+count+' questions imported from '+item.name+'!');
    },1200);

  }catch(err){
    item.status='error';
    item.error=err.message;
    updateImportedList();
    hideProc();
    toast('‚ùå AI error: '+err.message.substring(0,80));
  }
}

// ‚îÄ‚îÄ PROC UI ‚îÄ‚îÄ
let procSteps=['Extract text','Analyze content','Generate questions','Import to library'];

function showProc(title,sub,pct){
  document.getElementById('processing-wrap').style.display='block';
  document.getElementById('proc-title').textContent=title;
  document.getElementById('proc-sub').textContent=sub;
  document.getElementById('proc-bar').style.width=pct+'%';
  document.getElementById('proc-pct').textContent=pct+'%';
  document.getElementById('proc-steps').innerHTML=procSteps.map((s,i)=>`
    <div class="step">
      <div class="step-dot ${i===0?'active':'pending'}"></div>
      <span style="color:${i===0?'var(--accent)':'var(--muted2)'}">${s}</span>
    </div>`).join('');
}

function setProc(pct,title,sub){
  document.getElementById('proc-bar').style.width=pct+'%';
  document.getElementById('proc-pct').textContent=pct+'%';
  if(title)document.getElementById('proc-title').textContent=title;
  if(sub)document.getElementById('proc-sub').textContent=sub;
}

function updateStep(idx,state){
  const dots=document.querySelectorAll('.step-dot');
  const labels=document.querySelectorAll('.step span');
  if(dots[idx]){
    dots[idx].className='step-dot '+state;
    if(labels[idx])labels[idx].style.color=state==='done'?'var(--green)':state==='active'?'var(--accent)':'var(--muted2)';
  }
}

function hideProc(){document.getElementById('processing-wrap').style.display='none';}

function updateImportedList(){
  const wrap=document.getElementById('imported-wrap');
  const list=document.getElementById('imported-list');
  if(!importedFiles.length){wrap.style.display='none';return;}
  wrap.style.display='block';
  list.innerHTML=importedFiles.map(f=>{
    const statusBadge=f.status==='done'?`<span class="import-item-badge badge-done">‚úÖ ${f.count} questions</span>`:
      f.status==='error'?`<span class="import-item-badge badge-err">‚ùå Error</span>`:
      `<span class="import-item-badge badge-process">‚è≥ Processing‚Ä¶</span>`;
    const icon=f.type==='PDF'?'üìÑ':f.type==='TXT'?'üìù':'‚úçÔ∏è';
    return`<div class="import-item">
      <div class="import-item-icon">${icon}</div>
      <div class="import-item-info">
        <div class="import-item-name">${f.name}</div>
        <div class="import-item-meta">${f.type}${f.pageCount?' ¬∑ '+f.pageCount+' pages':''}</div>
      </div>
      ${statusBadge}
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê
let toastTO;
function toast(msg){
  const el=document.getElementById('toast-el');
  document.getElementById('toast-msg').textContent=msg;
  el.classList.add('on');
  clearTimeout(toastTO);
  toastTO=setTimeout(()=>el.classList.remove('on'),3500);
}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
renderDash();

// ‚îÄ‚îÄ PDF.js worker fix ‚îÄ‚îÄ
if(typeof pdfjsLib !== 'undefined') {
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
}

// ‚îÄ‚îÄ Mobile sidebar ‚îÄ‚îÄ
function toggleSidebar(){
  document.querySelector('.sidebar').classList.toggle('open');
  document.getElementById('mob-overlay').classList.toggle('on');
}
function closeSidebar(){
  document.querySelector('.sidebar').classList.remove('open');
  document.getElementById('mob-overlay').classList.remove('on');
}

// Close sidebar on nav click (mobile)
document.querySelectorAll('.nav-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    if(window.innerWidth<=768) closeSidebar();
  });
});
</script>
</body>
</html>
