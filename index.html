<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ValEd Prep Pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Sora:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

:root {
  --ink: #0D0F1A;
  --bg: #F7F8FC;
  --surface: #FFFFFF;
  --surface2: #F0F2FA;
  --border: #E4E6F0;
  --accent: #4F46E5;
  --accent2: #7C3AED;
  --accent-glow: rgba(79,70,229,0.18);
  --green: #059669;
  --green-bg: #ECFDF5;
  --red: #DC2626;
  --red-bg: #FEF2F2;
  --amber: #D97706;
  --amber-bg: #FFFBEB;
  --text: #1E2035;
  --muted: #6B7280;
  --muted2: #9CA3AF;
  --shadow: 0 2px 16px rgba(13,15,26,0.08);
  --shadow-lg: 0 8px 40px rgba(13,15,26,0.12);
  --shadow-accent: 0 8px 32px rgba(79,70,229,0.22);
  --r: 14px;
  --r-sm: 10px;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Sora', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ */
.shell { display: flex; min-height: 100vh; }

.sidebar {
  width: 248px;
  background: var(--ink);
  display: flex;
  flex-direction: column;
  padding: 24px 14px;
  position: fixed;
  top: 0; left: 0; bottom: 0;
  z-index: 100;
  overflow-y: auto;
}

.logo-wrap {
  display: flex; align-items: center; gap: 11px;
  padding: 4px 10px 22px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
  margin-bottom: 24px;
}

.logo-mark {
  width: 38px; height: 38px;
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 19px;
  box-shadow: 0 4px 16px rgba(79,70,229,0.4);
  flex-shrink: 0;
}

.logo-name { font-weight: 800; font-size: 18px; color: #fff; letter-spacing: -.5px; }
.logo-sub  { font-size: 10px; color: rgba(255,255,255,0.4); font-weight: 500; margin-top: 1px; }

.nav-section-label {
  font-size: 9.5px; font-weight: 700;
  color: rgba(255,255,255,0.3);
  text-transform: uppercase; letter-spacing: 1.2px;
  padding: 0 10px; margin-bottom: 8px;
}

.nav-btn {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 12px; border-radius: var(--r-sm);
  cursor: pointer; font-weight: 500; font-size: 13px;
  color: rgba(255,255,255,0.55);
  background: none; border: none; width: 100%; text-align: left;
  margin-bottom: 2px; transition: all .18s;
}
.nav-btn .ni { font-size: 16px; width: 20px; text-align: center; flex-shrink: 0; }
.nav-btn:hover { background: rgba(255,255,255,0.07); color: rgba(255,255,255,0.9); }
.nav-btn.active {
  background: linear-gradient(135deg, rgba(79,70,229,0.3), rgba(124,58,237,0.2));
  color: #fff;
  font-weight: 600;
  border: 1px solid rgba(79,70,229,0.35);
}

.sidebar-footer {
  margin-top: auto; padding-top: 16px;
  border-top: 1px solid rgba(255,255,255,0.08);
}

.streak-card {
  background: linear-gradient(135deg, #FF6B35, #E8521A);
  border-radius: var(--r-sm); padding: 12px 14px;
  color: white; font-size: 12px; font-weight: 600;
  display: flex; align-items: center; gap: 8px;
}

/* ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ */
.main { margin-left: 248px; padding: 32px; flex: 1; min-height: 100vh; }

/* ‚îÄ‚îÄ PAGE ‚îÄ‚îÄ */
.page { display: none; animation: fadeUp .25s ease; }
.page.on { display: block; }
@keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

.page-header { margin-bottom: 28px; }
.page-title { font-size: 26px; font-weight: 800; color: var(--ink); letter-spacing: -.6px; }
.page-sub   { font-size: 13px; color: var(--muted); margin-top: 4px; }

/* ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ */
.stats-row { display: grid; grid-template-columns: repeat(4,1fr); gap: 14px; margin-bottom: 24px; }

.stat-card {
  background: var(--surface); border-radius: var(--r);
  padding: 20px 18px; box-shadow: var(--shadow);
  border: 1px solid var(--border); position: relative; overflow: hidden;
}
.stat-card::after {
  content: ''; position: absolute; top: -20px; right: -20px;
  width: 80px; height: 80px; border-radius: 50%; opacity: .08;
}
.stat-card.c1::after { background: var(--accent); }
.stat-card.c2::after { background: var(--green); }
.stat-card.c3::after { background: var(--amber); }
.stat-card.c4::after { background: var(--red); }

.stat-icon { font-size: 22px; margin-bottom: 10px; }
.stat-val  { font-size: 28px; font-weight: 800; color: var(--ink); }
.stat-lbl  { font-size: 11px; color: var(--muted); font-weight: 500; margin-top: 3px; }

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card {
  background: var(--surface); border-radius: var(--r);
  padding: 22px; box-shadow: var(--shadow);
  border: 1px solid var(--border);
}
.card-title { font-size: 15px; font-weight: 700; color: var(--ink); margin-bottom: 16px; }

/* ‚îÄ‚îÄ GRID ‚îÄ‚îÄ */
.g2 { display: grid; grid-template-columns: 1fr 1fr; gap: 18px; }
.g3 { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; }

/* ‚îÄ‚îÄ IMPORT ZONE ‚îÄ‚îÄ */
.import-zone {
  border: 2px dashed var(--border);
  border-radius: var(--r);
  padding: 48px 32px;
  text-align: center;
  cursor: pointer;
  transition: all .2s;
  background: var(--bg);
  position: relative;
  overflow: hidden;
}
.import-zone.drag { border-color: var(--accent); background: var(--accent-glow); }
.import-zone:hover { border-color: var(--accent); }

.import-icon { font-size: 48px; margin-bottom: 14px; }
.import-title { font-size: 18px; font-weight: 700; color: var(--ink); margin-bottom: 8px; }
.import-sub   { font-size: 13px; color: var(--muted); margin-bottom: 20px; }
.import-types { display: flex; gap: 8px; justify-content: center; flex-wrap: wrap; }
.type-badge {
  padding: 4px 12px; border-radius: 999px;
  font-size: 11px; font-weight: 600;
  background: var(--surface2); color: var(--muted);
  border: 1px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
}

/* ‚îÄ‚îÄ BTN ‚îÄ‚îÄ */
.btn {
  padding: 10px 22px; border-radius: var(--r-sm);
  font-weight: 600; font-size: 13px; font-family: 'Sora', sans-serif;
  border: none; cursor: pointer; transition: all .18s;
  display: inline-flex; align-items: center; gap: 8px;
}
.btn-accent {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  color: #fff;
  box-shadow: var(--shadow-accent);
}
.btn-accent:hover { transform: translateY(-1px); box-shadow: 0 12px 40px rgba(79,70,229,0.35); }
.btn-outline { background: var(--surface); color: var(--text); border: 1.5px solid var(--border); }
.btn-outline:hover { border-color: var(--accent); color: var(--accent); }
.btn-lg { padding: 13px 28px; font-size: 15px; border-radius: var(--r); }
.btn-sm { padding: 7px 14px; font-size: 12px; }

/* ‚îÄ‚îÄ PROCESSING ‚îÄ‚îÄ */
.processing-card {
  background: linear-gradient(135deg, rgba(79,70,229,0.05), rgba(124,58,237,0.05));
  border: 2px solid rgba(79,70,229,0.2);
  border-radius: var(--r);
  padding: 32px;
  text-align: center;
}

.spinner {
  width: 48px; height: 48px;
  border: 4px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin: 0 auto 16px;
}
@keyframes spin { to { transform: rotate(360deg); } }

.progress-track { background: var(--border); border-radius: 999px; height: 6px; margin: 16px 0 8px; overflow: hidden; }
.progress-fill  { height: 100%; border-radius: 999px; background: linear-gradient(90deg, var(--accent), var(--accent2)); transition: width .3s ease; }

/* ‚îÄ‚îÄ IMPORT LIST ‚îÄ‚îÄ */
.import-list { display: flex; flex-direction: column; gap: 10px; }

.import-item {
  background: var(--surface); border-radius: var(--r-sm);
  padding: 14px 18px; border: 1px solid var(--border);
  display: flex; align-items: center; gap: 14px;
  box-shadow: var(--shadow);
}
.import-item-icon { font-size: 28px; flex-shrink: 0; }
.import-item-info { flex: 1; }
.import-item-name { font-size: 14px; font-weight: 600; color: var(--ink); }
.import-item-meta { font-size: 11px; color: var(--muted); margin-top: 3px; }
.import-item-badge {
  padding: 4px 12px; border-radius: 999px; font-size: 11px; font-weight: 600;
}
.badge-done    { background: var(--green-bg); color: var(--green); }
.badge-process { background: var(--amber-bg); color: var(--amber); }
.badge-err     { background: var(--red-bg);   color: var(--red);   }

/* ‚îÄ‚îÄ SUBJECT CARDS ‚îÄ‚îÄ */
.subj-card {
  background: var(--surface); border-radius: var(--r);
  padding: 22px; box-shadow: var(--shadow);
  cursor: pointer; transition: all .2s;
  border: 1.5px solid var(--border);
}
.subj-card:hover { box-shadow: var(--shadow-accent); transform: translateY(-2px); border-color: var(--accent); }
.subj-icon  { font-size: 34px; margin-bottom: 10px; }
.subj-name  { font-size: 14px; font-weight: 700; color: var(--ink); margin-bottom: 3px; }
.subj-count { font-size: 11px; color: var(--muted); }
.prog-bg    { background: var(--surface2); border-radius: 999px; height: 5px; overflow: hidden; margin-top: 12px; }
.prog-fill  { height: 100%; border-radius: 999px; }

/* ‚îÄ‚îÄ FLASHCARD ‚îÄ‚îÄ */
.pill-row   { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
.pill {
  padding: 5px 14px; border-radius: 999px;
  font-size: 12px; font-weight: 500;
  border: 1.5px solid var(--border);
  background: var(--surface); color: var(--muted);
  cursor: pointer; transition: all .15s;
}
.pill.on, .pill:hover { border-color: var(--accent); background: var(--accent); color: #fff; }

.fc-scene   { width: 100%; height: 340px; perspective: 1200px; margin-bottom: 24px; }
.fc-inner   { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform .65s cubic-bezier(.4,0,.2,1); cursor: pointer; }
.fc-inner.flipped { transform: rotateY(180deg); }
.fc-face    { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: var(--r); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 44px; text-align: center; }
.fc-front   { background: linear-gradient(135deg, #4F46E5 0%, #7C3AED 60%, #9333EA 100%); box-shadow: 0 16px 48px rgba(79,70,229,0.3); }
.fc-back    { background: var(--surface); border: 1.5px solid var(--border); transform: rotateY(180deg); box-shadow: var(--shadow-lg); }

.fc-chip    { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 1.8px; margin-bottom: 16px; padding: 4px 12px; border-radius: 999px; }
.fc-front .fc-chip { background: rgba(255,255,255,0.2); color: rgba(255,255,255,0.9); }
.fc-back  .fc-chip { background: var(--accent-glow); color: var(--accent); }

.fc-q  { font-size: 21px; font-weight: 700; color: #fff; line-height: 1.55; }
.fc-a  { font-size: 18px; font-weight: 600; color: var(--ink); line-height: 1.55; }
.fc-exp-box { margin-top: 14px; font-size: 12px; color: var(--muted); background: var(--surface2); padding: 10px 16px; border-radius: 8px; line-height: 1.6; max-width: 520px; }
.fc-hint { margin-top: 20px; font-size: 11px; color: rgba(255,255,255,0.5); }

.fc-nav { display: flex; align-items: center; justify-content: center; gap: 14px; margin-bottom: 18px; }
.nav-circle {
  width: 44px; height: 44px; border-radius: 50%;
  border: 1.5px solid var(--border); background: var(--surface);
  font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center;
  box-shadow: var(--shadow); transition: all .15s;
}
.nav-circle:hover { border-color: var(--accent); color: var(--accent); }
.nav-circle:disabled { opacity: .35; cursor: not-allowed; }
.fc-count { font-size: 13px; font-weight: 600; color: var(--muted); min-width: 70px; text-align: center; }

.rate-row   { display: flex; gap: 12px; justify-content: center; }
.rate-btn   { padding: 9px 22px; border-radius: 999px; border: none; font-weight: 600; font-size: 13px; cursor: pointer; font-family: 'Sora', sans-serif; transition: all .15s; }
.rate-btn:hover { transform: scale(1.05); }
.rb-hard  { background: var(--red-bg);   color: var(--red);   }
.rb-ok    { background: var(--amber-bg); color: var(--amber); }
.rb-easy  { background: var(--green-bg); color: var(--green); }

/* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
.quiz-header { display: flex; align-items: center; gap: 16px; margin-bottom: 20px; }
.qprog-wrap  { flex: 1; max-width: 400px; }
.qprog-bar   { height: 7px; background: var(--surface2); border-radius: 999px; overflow: hidden; }
.qprog-fill  { height: 100%; background: linear-gradient(90deg, var(--accent), var(--accent2)); border-radius: 999px; transition: width .4s; }
.qprog-lbl   { font-size: 11px; color: var(--muted); margin-top: 5px; }

.timer-pill {
  padding: 7px 18px; background: var(--surface); border-radius: 999px;
  box-shadow: var(--shadow); font-weight: 800; font-size: 20px;
  min-width: 90px; text-align: center; border: 1.5px solid var(--border);
  font-family: 'JetBrains Mono', monospace;
}
.timer-pill.warn   { color: var(--amber); border-color: var(--amber-bg); }
.timer-pill.danger { color: var(--red); border-color: var(--red-bg); animation: blink .5s infinite alternate; }
@keyframes blink { from{opacity:1} to{opacity:.55} }

.qcard { background: var(--surface); border-radius: var(--r); padding: 28px; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 16px; }
.q-num  { font-size: 11px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px; }
.q-text { font-size: 18px; font-weight: 700; line-height: 1.65; color: var(--ink); }

.choices { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

.choice-btn {
  padding: 15px 18px; border-radius: var(--r-sm);
  border: 1.5px solid var(--border); background: var(--surface);
  text-align: left; cursor: pointer; font-size: 13px; font-weight: 500;
  color: var(--text); display: flex; align-items: center; gap: 12px;
  box-shadow: 0 1px 4px rgba(0,0,0,.04); transition: all .15s;
  font-family: 'Sora', sans-serif;
}
.choice-btn:hover:not(:disabled) { border-color: var(--accent); background: rgba(79,70,229,0.04); color: var(--accent); }
.choice-btn.correct { border-color: var(--green)!important; background: var(--green-bg)!important; color: var(--green)!important; }
.choice-btn.wrong   { border-color: var(--red)!important;   background: var(--red-bg)!important;   color: var(--red)!important;   }
.choice-btn:disabled { cursor: default; }

.choice-letter {
  width: 28px; height: 28px; border-radius: 50%;
  background: var(--surface2); display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 11px; flex-shrink: 0;
}
.choice-btn.correct .choice-letter { background: var(--green); color: #fff; }
.choice-btn.wrong   .choice-letter { background: var(--red);   color: #fff; }

.expl-box {
  background: rgba(79,70,229,0.05); border-left: 3px solid var(--accent);
  border-radius: 0 var(--r-sm) var(--r-sm) 0;
  padding: 14px 18px; margin-top: 14px;
  font-size: 13px; color: var(--text); display: none; line-height: 1.6;
}
.expl-box.on { display: block; animation: fadeUp .25s ease; }
.qa-row { display: flex; justify-content: flex-end; margin-top: 14px; }

/* ‚îÄ‚îÄ SCORES ‚îÄ‚îÄ */
.score-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 14px; margin-bottom: 22px; }
.score-stat { background: var(--surface); border-radius: var(--r); padding: 20px; box-shadow: var(--shadow); border: 1px solid var(--border); text-align: center; }
.ss-v { font-size: 30px; font-weight: 800; }
.ss-l { font-size: 11px; color: var(--muted); margin-top: 3px; }

.history-list { display: flex; flex-direction: column; gap: 10px; }
.history-item {
  background: var(--surface); border-radius: var(--r-sm); padding: 16px 20px;
  border: 1px solid var(--border); box-shadow: var(--shadow);
  display: flex; align-items: center; gap: 14px;
}
.hist-rank { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 14px; flex-shrink: 0; }
.hist-rank.hi  { background: var(--green-bg); color: var(--green); }
.hist-rank.mid { background: var(--amber-bg); color: var(--amber); }
.hist-rank.lo  { background: var(--red-bg);   color: var(--red);   }
.hist-info { flex: 1; }
.hist-title { font-size: 14px; font-weight: 600; }
.hist-meta  { font-size: 11px; color: var(--muted); margin-top: 2px; }
.hist-pct   { font-size: 22px; font-weight: 800; }

/* ‚îÄ‚îÄ ADD FORM ‚îÄ‚îÄ */
.form-group  { margin-bottom: 16px; }
.form-label  { font-size: 12px; font-weight: 600; color: var(--text); display: block; margin-bottom: 6px; }
.form-ctrl   { width: 100%; padding: 10px 14px; border: 1.5px solid var(--border); border-radius: var(--r-sm); font-size: 13px; font-family: 'Sora', sans-serif; color: var(--text); outline: none; background: var(--surface2); transition: border-color .15s; }
.form-ctrl:focus { border-color: var(--accent); background: var(--surface); }
textarea.form-ctrl { resize: vertical; min-height: 76px; }
.choice-inputs-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.ci-wrap { display: flex; gap: 8px; align-items: center; }
.ci-lbl  { width: 26px; height: 26px; border-radius: 50%; background: var(--accent); color: #fff; font-weight: 700; font-size: 11px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }

.q-list   { display: flex; flex-direction: column; gap: 8px; max-height: 480px; overflow-y: auto; }
.q-item   { background: var(--surface2); border: 1px solid var(--border); border-radius: var(--r-sm); padding: 10px 14px; display: flex; align-items: center; gap: 10px; }
.q-item-t { flex: 1; }
.q-item-q { font-size: 12px; color: var(--text); font-weight: 500; }
.q-item-m { font-size: 10px; color: var(--muted2); margin-top: 2px; }
.del-btn  { width: 26px; height: 26px; border-radius: 50%; border: none; background: var(--red-bg); color: var(--red); cursor: pointer; font-size: 13px; display: flex; align-items: center; justify-content: center; transition: all .15s; flex-shrink: 0; }
.del-btn:hover { background: var(--red); color: #fff; }

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.overlay { display: none; position: fixed; inset: 0; background: rgba(13,15,26,0.6); backdrop-filter: blur(6px); z-index: 200; align-items: center; justify-content: center; }
.overlay.on { display: flex; }
.modal { background: var(--surface); border-radius: 22px; padding: 44px; max-width: 460px; width: 90%; text-align: center; box-shadow: 0 24px 80px rgba(0,0,0,0.25); animation: modalIn .35s cubic-bezier(.34,1.56,.64,1); }
@keyframes modalIn { from{transform:translateY(50px);opacity:0} to{transform:translateY(0);opacity:1} }

.modal-emoji { font-size: 58px; margin-bottom: 14px; }
.modal-title { font-size: 26px; font-weight: 800; color: var(--ink); margin-bottom: 8px; letter-spacing: -.5px; }
.modal-sub   { font-size: 13px; color: var(--muted); margin-bottom: 28px; }

.score-ring { width: 130px; height: 130px; border-radius: 50%; margin: 0 auto 24px; display: flex; align-items: center; justify-content: center; }
.score-ring-inner { width: 104px; height: 104px; border-radius: 50%; background: var(--surface); display: flex; flex-direction: column; align-items: center; justify-content: center; }
.ring-pct { font-size: 28px; font-weight: 800; color: var(--ink); }
.ring-lbl { font-size: 10px; color: var(--muted2); font-weight: 600; letter-spacing: .5px; }

.result-stats { display: flex; gap: 28px; justify-content: center; margin-bottom: 28px; }
.rs { text-align: center; }
.rs-v { font-size: 24px; font-weight: 800; }
.rs-l { font-size: 11px; color: var(--muted); }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  position: fixed; bottom: 24px; right: 24px;
  background: var(--ink); color: #fff;
  padding: 12px 18px; border-radius: var(--r-sm);
  font-size: 13px; font-weight: 500;
  box-shadow: 0 8px 32px rgba(0,0,0,.25);
  display: none; align-items: center; gap: 10px; z-index: 999;
}
.toast.on { display: flex; animation: toastIn .3s ease; }
@keyframes toastIn { from{transform:translateX(80px);opacity:0} to{transform:translateX(0);opacity:1} }

.chip { display: inline-block; padding: 2px 10px; border-radius: 999px; font-size: 11px; font-weight: 600; background: rgba(79,70,229,0.1); color: var(--accent); }

.empty-state { text-align: center; padding: 52px; color: var(--muted2); }
.empty-icon  { font-size: 44px; margin-bottom: 10px; }
.empty-t     { font-size: 15px; font-weight: 600; color: var(--muted); }
.empty-s     { font-size: 12px; margin-top: 4px; }

/* quiz setup form */
.quiz-setup-card { background: var(--surface); border-radius: var(--r); padding: 28px; box-shadow: var(--shadow); border: 1px solid var(--border); max-width: 520px; }

/* quick actions */
.quick-actions { display: flex; flex-direction: column; gap: 10px; }

/* import progress steps */
.steps { display: flex; flex-direction: column; gap: 8px; margin-top: 16px; text-align: left; }
.step { display: flex; align-items: center; gap: 10px; font-size: 13px; }
.step-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.step-dot.done    { background: var(--green); }
.step-dot.active  { background: var(--accent); animation: dotPulse 1s infinite; }
.step-dot.pending { background: var(--border); }
@keyframes dotPulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.5)} }
</style>
</head>
<body>
<div class="shell">

<!-- ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ -->
<aside class="sidebar">
  <div class="logo-wrap">
    <div class="logo-mark">üìö</div>
    <div>
      <div class="logo-name">ValEd Pro</div>
      <div class="logo-sub">Values Education Reviewer</div>
    </div>
  </div>

  <div class="nav-section-label">Study</div>
  <button class="nav-btn active" data-page="dashboard" onclick="go('dashboard')"><span class="ni">üè†</span>Dashboard</button>
  <button class="nav-btn" data-page="import" onclick="go('import')"><span class="ni">üì•</span>Import Files <span style="margin-left:auto;background:linear-gradient(135deg,#4F46E5,#7C3AED);color:#fff;font-size:9px;font-weight:700;padding:2px 7px;border-radius:999px">NEW</span></button>
  <button class="nav-btn" data-page="subjects" onclick="go('subjects')"><span class="ni">üìÇ</span>Subjects</button>
  <button class="nav-btn" data-page="flashcards" onclick="go('flashcards')"><span class="ni">üÉè</span>Flashcards</button>
  <button class="nav-btn" data-page="quiz" onclick="go('quiz')"><span class="ni">‚úèÔ∏è</span>Quiz Mode</button>

  <div class="nav-section-label" style="margin-top:12px">Progress</div>
  <button class="nav-btn" data-page="scores" onclick="go('scores')"><span class="ni">üìä</span>My Scores</button>
  <button class="nav-btn" data-page="add" onclick="go('add')"><span class="ni">‚ûï</span>Add Questions</button>

  <div class="sidebar-footer">
    <div class="streak-card">üî• Keep studying ‚Äî you've got this!</div>
  </div>
</aside>

<!-- ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ -->
<main class="main">

<!-- DASHBOARD -->
<div id="pg-dashboard" class="page on">
  <div class="page-header">
    <div class="page-title">Good day! üëã</div>
    <div class="page-sub">Your Values Education board exam reviewer ‚Äî powered by AI</div>
  </div>
  <div class="stats-row">
    <div class="stat-card c1"><div class="stat-icon">üìù</div><div class="stat-val" id="st-total">0</div><div class="stat-lbl">Total Questions</div></div>
    <div class="stat-card c2"><div class="stat-icon">‚úÖ</div><div class="stat-val" id="st-correct">0</div><div class="stat-lbl">Correct Answers</div></div>
    <div class="stat-card c3"><div class="stat-icon">üéØ</div><div class="stat-val" id="st-acc">‚Äî</div><div class="stat-lbl">Accuracy Rate</div></div>
    <div class="stat-card c4"><div class="stat-icon">üÉè</div><div class="stat-val" id="st-flash">0</div><div class="stat-lbl">Cards Reviewed</div></div>
  </div>
  <div class="g2">
    <div class="card">
      <div class="card-title">üöÄ Quick Start</div>
      <div class="quick-actions">
        <button class="btn btn-accent btn-lg" style="width:100%" onclick="go('import')">üì• Import PDF / Document</button>
        <button class="btn btn-accent btn-lg" style="width:100%;background:linear-gradient(135deg,#059669,#047857)" onclick="go('flashcards')">üÉè Start Flashcards</button>
        <button class="btn btn-outline btn-lg" style="width:100%" onclick="go('quiz')">‚úèÔ∏è Take a Quiz</button>
      </div>
    </div>
    <div class="card">
      <div class="card-title">üìå Study Topics</div>
      <div id="db-topics" style="display:flex;flex-direction:column;gap:8px;"></div>
    </div>
  </div>
</div>

<!-- IMPORT -->
<div id="pg-import" class="page">
  <div class="page-header">
    <div class="page-title">üì• Import Files</div>
    <div class="page-sub">Upload your reviewers ‚Äî AI will extract questions automatically</div>
  </div>

  <!-- API Key input -->
  <div class="card" style="margin-bottom:20px;border:1.5px solid rgba(79,70,229,0.3);background:rgba(79,70,229,0.03)">
    <div class="card-title" style="margin-bottom:10px">üîë Anthropic API Key</div>
    <div style="font-size:12px;color:var(--muted);margin-bottom:10px">Required for AI question extraction. Your key is never stored or sent anywhere except directly to Anthropic.</div>
    <div style="display:flex;gap:10px;align-items:center">
      <input type="password" class="form-ctrl" id="api-key-input" placeholder="sk-ant-..." style="flex:1;font-family:'JetBrains Mono',monospace;font-size:12px">
      <button class="btn btn-outline btn-sm" onclick="toggleApiKeyVis()">üëÅ Show</button>
    </div>
  </div>

  <div id="import-dropzone" class="import-zone"
    ondragover="event.preventDefault();this.classList.add('drag')"
    ondragleave="this.classList.remove('drag')"
    ondrop="handleDrop(event)"
    onclick="document.getElementById('file-input').click()">
    <div class="import-icon">üìÑ</div>
    <div class="import-title">Drop your reviewer files here</div>
    <div class="import-sub">Or click to browse ‚Äî AI will read and extract questions automatically</div>
    <div class="import-types">
      <span class="type-badge">.PDF</span>
      <span class="type-badge">.TXT</span>
      <span class="type-badge">.DOC (paste text)</span>
    </div>
    <br>
    <button class="btn btn-accent" onclick="event.stopPropagation();document.getElementById('file-input').click()">üìÇ Browse Files</button>
  </div>
  <input type="file" id="file-input" accept=".pdf,.txt,.md" multiple style="display:none" onchange="handleFiles(this.files)">

  <!-- Processing indicator -->
  <div id="processing-wrap" style="display:none;margin-top:20px">
    <div class="processing-card">
      <div class="spinner"></div>
      <div style="font-size:16px;font-weight:700;color:var(--ink)" id="proc-title">Analyzing your document‚Ä¶</div>
      <div style="font-size:13px;color:var(--muted);margin-top:6px" id="proc-sub">Reading content and extracting questions</div>
      <div class="progress-track"><div class="progress-fill" id="proc-bar" style="width:0%"></div></div>
      <div style="font-size:12px;color:var(--muted2);font-family:'JetBrains Mono',monospace" id="proc-pct">0%</div>
      <div class="steps" id="proc-steps"></div>
    </div>
  </div>

  <!-- Paste text fallback -->
  <div class="card" style="margin-top:20px">
    <div class="card-title">‚úçÔ∏è Or Paste Text Directly</div>
    <div style="font-size:13px;color:var(--muted);margin-bottom:14px">Copy text from your reviewer and paste it below ‚Äî AI will extract all questions</div>
    <textarea class="form-ctrl" id="paste-text" placeholder="Paste your reviewer content here‚Ä¶ (questions, choices, topics, notes ‚Äî any format works)" style="min-height:120px"></textarea>
    <div style="display:flex;gap:10px;align-items:center;margin-top:12px;flex-wrap:wrap">
      <select class="form-ctrl" id="paste-subject" style="max-width:220px">
        <option value="Ethics &amp; Morality">‚öñÔ∏è Ethics &amp; Morality</option>
        <option value="Filipino Values">üáµüá≠ Filipino Values</option>
        <option value="Human Rights">‚úä Human Rights</option>
        <option value="Citizenship &amp; Civic Duty">üèõÔ∏è Citizenship &amp; Civic Duty</option>
        <option value="Character Education">üí° Character Education</option>
        <option value="Social Responsibility">ü§ù Social Responsibility</option>
        <option value="General Values Education">üìö General Values Education</option>
      </select>
      <button class="btn btn-accent" onclick="processPastedText()">ü§ñ Extract Questions with AI</button>
    </div>
  </div>

  <!-- Imported files list -->
  <div id="imported-wrap" style="margin-top:20px;display:none">
    <div style="font-size:15px;font-weight:700;color:var(--ink);margin-bottom:12px">üìã Imported Files</div>
    <div class="import-list" id="imported-list"></div>
  </div>
</div>

<!-- SUBJECTS -->
<div id="pg-subjects" class="page">
  <div class="page-header"><div class="page-title">üìÇ Subjects</div><div class="page-sub">Browse all topics and start studying</div></div>
  <div class="g3" id="subjects-grid"></div>
</div>

<!-- FLASHCARDS -->
<div id="pg-flashcards" class="page">
  <div class="page-header"><div class="page-title">üÉè Flashcards</div><div class="page-sub">Click the card to reveal the answer</div></div>
  <div class="pill-row" id="fc-pills"></div>
  <div class="fc-scene">
    <div class="fc-inner" id="fc-inner" onclick="flipCard()">
      <div class="fc-face fc-front">
        <div class="fc-chip">Question</div>
        <div class="fc-q" id="fc-q">Select a subject above to begin</div>
        <div class="fc-hint">üëÜ Click to reveal answer</div>
      </div>
      <div class="fc-face fc-back">
        <div class="fc-chip">Answer</div>
        <div class="fc-a" id="fc-a">‚Äî</div>
        <div class="fc-exp-box" id="fc-exp" style="display:none"></div>
      </div>
    </div>
  </div>
  <div class="fc-nav">
    <button class="nav-circle" id="fc-prev" onclick="fcPrev()">‚Üê</button>
    <div class="fc-count" id="fc-count">‚Äî</div>
    <button class="nav-circle" id="fc-next" onclick="fcNext()">‚Üí</button>
  </div>
  <div id="rate-area" style="display:none;text-align:center">
    <div style="font-size:12px;color:var(--muted);margin-bottom:10px">How well did you know this?</div>
    <div class="rate-row">
      <button class="rate-btn rb-hard" onclick="rateCard('hard')">üòì Hard</button>
      <button class="rate-btn rb-ok"   onclick="rateCard('ok')">üòê OK</button>
      <button class="rate-btn rb-easy" onclick="rateCard('easy')">üòÑ Easy</button>
    </div>
  </div>
</div>

<!-- QUIZ -->
<div id="pg-quiz" class="page">
  <div class="page-header"><div class="page-title">‚úèÔ∏è Quiz Mode</div><div class="page-sub">Multiple choice with instant feedback and explanations</div></div>
  <div id="quiz-setup" class="quiz-setup-card">
    <div style="font-size:17px;font-weight:700;margin-bottom:18px">Configure Your Quiz</div>
    <div class="form-group"><label class="form-label">Subject</label><select class="form-ctrl" id="qz-subj"></select></div>
    <div class="form-group"><label class="form-label">Number of Questions</label>
      <select class="form-ctrl" id="qz-num"><option value="5">5 questions</option><option value="10" selected>10 questions</option><option value="20">20 questions</option><option value="all">All available</option></select></div>
    <div class="form-group"><label class="form-label">Timer per Question</label>
      <select class="form-ctrl" id="qz-timer"><option value="0">No timer</option><option value="30">30 seconds</option><option value="60" selected>60 seconds</option><option value="90">90 seconds</option></select></div>
    <button class="btn btn-accent btn-lg" style="width:100%;margin-top:6px" onclick="startQuiz()">üöÄ Start Quiz</button>
  </div>

  <div id="quiz-active" style="display:none">
    <div class="quiz-header">
      <div class="qprog-wrap">
        <div class="qprog-bar"><div class="qprog-fill" id="qpf" style="width:0%"></div></div>
        <div class="qprog-lbl" id="qpl">Question 1 of 10</div>
      </div>
      <div class="timer-pill" id="timer-pill" style="display:none">‚è± <span id="timer-v">60</span>s</div>
      <button class="btn btn-outline btn-sm" onclick="endQuiz()" style="margin-left:8px">Quit</button>
    </div>
    <div class="qcard">
      <div class="q-num" id="q-num">Question 1</div>
      <div class="q-text" id="q-text">Loading‚Ä¶</div>
    </div>
    <div class="choices" id="choices-grid"></div>
    <div class="expl-box" id="expl-box"></div>
    <div class="qa-row"><button class="btn btn-accent" id="next-btn" onclick="nextQ()" style="display:none">Next ‚Üí</button></div>
  </div>
</div>

<!-- SCORES -->
<div id="pg-scores" class="page">
  <div class="page-header"><div class="page-title">üìä My Scores</div><div class="page-sub">Track your performance over time</div></div>
  <div class="score-grid">
    <div class="score-stat"><div class="ss-v" id="sc-att" style="color:var(--accent)">0</div><div class="ss-l">Attempted</div></div>
    <div class="score-stat"><div class="ss-v" id="sc-cor" style="color:var(--green)">0</div><div class="ss-l">Correct</div></div>
    <div class="score-stat"><div class="ss-v" id="sc-acc">‚Äî</div><div class="ss-l">Accuracy</div></div>
  </div>
  <div id="history-wrap"></div>
</div>

<!-- ADD -->
<div id="pg-add" class="page">
  <div class="page-header"><div class="page-title">‚ûï Add Questions</div><div class="page-sub">Manually add questions to your bank</div></div>
  <div class="g2">
    <div>
      <div class="card">
        <div class="card-title">New Question</div>
        <div class="form-group"><label class="form-label">Subject</label><select class="form-ctrl" id="nq-s"></select></div>
        <div class="form-group"><label class="form-label">Question</label><textarea class="form-ctrl" id="nq-q" placeholder="Enter your question‚Ä¶"></textarea></div>
        <div class="form-group">
          <label class="form-label">Answer Choices</label>
          <div class="choice-inputs-grid">
            <div class="ci-wrap"><div class="ci-lbl">A</div><input class="form-ctrl" id="nq-a" placeholder="Choice A"></div>
            <div class="ci-wrap"><div class="ci-lbl">B</div><input class="form-ctrl" id="nq-b" placeholder="Choice B"></div>
            <div class="ci-wrap"><div class="ci-lbl">C</div><input class="form-ctrl" id="nq-c" placeholder="Choice C"></div>
            <div class="ci-wrap"><div class="ci-lbl">D</div><input class="form-ctrl" id="nq-d" placeholder="Choice D"></div>
          </div>
        </div>
        <div class="form-group"><label class="form-label">Correct Answer</label>
          <select class="form-ctrl" id="nq-ans"><option>A</option><option>B</option><option>C</option><option>D</option></select></div>
        <div class="form-group"><label class="form-label">Explanation (optional)</label>
          <textarea class="form-ctrl" id="nq-exp" placeholder="Why is this the correct answer?" style="min-height:60px"></textarea></div>
        <button class="btn btn-accent" style="width:100%" onclick="addQ()">‚úÖ Add Question</button>
      </div>
    </div>
    <div>
      <div class="card">
        <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
          <div class="card-title" style="margin-bottom:0">üìã All Questions</div>
          <span class="chip" id="q-badge">0</span>
        </div>
        <div class="q-list" id="q-list"></div>
      </div>
    </div>
  </div>
</div>

</main>
</div>

<!-- RESULTS MODAL -->
<div class="overlay" id="result-overlay">
  <div class="modal">
    <div class="modal-emoji" id="res-emoji">üéâ</div>
    <div class="modal-title" id="res-title">Quiz Complete!</div>
    <div class="modal-sub">Here's how you did:</div>
    <div class="score-ring" id="score-ring">
      <div class="score-ring-inner">
        <div class="ring-pct" id="ring-pct">0%</div>
        <div class="ring-lbl">SCORE</div>
      </div>
    </div>
    <div class="result-stats">
      <div class="rs"><div class="rs-v" id="rs-cor" style="color:var(--green)">0</div><div class="rs-l">Correct</div></div>
      <div class="rs"><div class="rs-v" id="rs-wro" style="color:var(--red)">0</div><div class="rs-l">Wrong</div></div>
      <div class="rs"><div class="rs-v" id="rs-tot">0</div><div class="rs-l">Total</div></div>
    </div>
    <div style="display:flex;gap:12px;justify-content:center">
      <button class="btn btn-outline" onclick="closeResult()">Close</button>
      <button class="btn btn-accent" onclick="closeResult();go('quiz')">Try Again üîÑ</button>
    </div>
  </div>
</div>

<div class="toast" id="toast-el">‚úÖ <span id="toast-msg"></span></div>

<script>
// ‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê
pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

function toggleApiKeyVis(){
  const inp=document.getElementById('api-key-input');
  inp.type=inp.type==='password'?'text':'password';
}

// ‚ïê‚ïê‚ïê DATA ‚ïê‚ïê‚ïê
const SUBJECTS=[
  {name:'Ethics & Morality',icon:'‚öñÔ∏è',color:'#4F46E5'},
  {name:'Filipino Values',icon:'üáµüá≠',color:'#DC2626'},
  {name:'Human Rights',icon:'‚úä',color:'#059669'},
  {name:'Citizenship & Civic Duty',icon:'üèõÔ∏è',color:'#D97706'},
  {name:'Character Education',icon:'üí°',color:'#7C3AED'},
  {name:'Social Responsibility',icon:'ü§ù',color:'#0891B2'},
  {name:'General Values Education',icon:'üìö',color:'#BE185D'},
];

let Q=[
  {id:1,subject:'Ethics & Morality',question:'What is the Golden Rule in ethics?',choices:['Do unto others as you would have them do unto you','Always tell the truth no matter what','Follow the law at all times','Respect authority above all'],answer:0,explanation:'The Golden Rule is a universal moral principle: treat others the way you want to be treated.'},
  {id:2,subject:'Ethics & Morality',question:'Which philosopher is known for the Categorical Imperative?',choices:['Aristotle','John Stuart Mill','Immanuel Kant','Plato'],answer:2,explanation:"Kant's Categorical Imperative: Act only according to maxims you would will to become universal laws."},
  {id:3,subject:'Ethics & Morality',question:'Utilitarianism promotes:',choices:['Individual rights above all','The greatest good for the greatest number','Strict adherence to rules','Virtue and character development'],answer:1,explanation:'Utilitarianism (Bentham & Mill): the best action maximizes overall happiness or utility.'},
  {id:4,subject:'Ethics & Morality',question:'Which value refers to treating all people fairly and without bias?',choices:['Loyalty','Justice','Prudence','Fortitude'],answer:1,explanation:'Justice is the moral virtue of consistently giving to God and neighbor what is their due.'},
  {id:5,subject:'Filipino Values',question:"'Utang na loob' in Filipino culture refers to:",choices:['A sense of gratitude and debt of goodwill','Fear of shame or embarrassment','Group solidarity','Respect for elders'],answer:0,explanation:"Utang na loob (debt of goodwill) involves gratitude and obligation to repay kindness received."},
  {id:6,subject:'Filipino Values',question:"'Hiya' as a Filipino value means:",choices:['Pride and honor','Sense of shame or propriety','Loyalty to family','Patience and endurance'],answer:1,explanation:"Hiya (shame/propriety) motivates Filipinos to maintain social harmony and avoid embarrassment."},
  {id:7,subject:'Filipino Values',question:"'Bayanihan' refers to:",choices:['Individual success','Community spirit and mutual aid','Religious devotion','Respect for authority'],answer:1,explanation:"Bayanihan is the Filipino spirit of communal unity and cooperation ‚Äî helping others without expecting payment."},
  {id:8,subject:'Filipino Values',question:"'Pakikisama' means:",choices:['Getting along well with the group','Avoiding conflict at all costs','Blind obedience','Seeking personal gain'],answer:0,explanation:"Pakikisama means togetherness and group cohesion ‚Äî getting along and maintaining harmony."},
  {id:9,subject:'Human Rights',question:'The Universal Declaration of Human Rights was adopted in:',choices:['1945','1948','1950','1955'],answer:1,explanation:'The UDHR was adopted by the UN General Assembly on December 10, 1948 ‚Äî now Human Rights Day.'},
  {id:10,subject:'Human Rights',question:'Human rights are best described as:',choices:['Granted by government','Universal, inherent, and inalienable','Earned through citizenship','Limited to adults only'],answer:1,explanation:'Human rights are universal (for everyone), inherent (born with them), and inalienable (cannot be permanently removed).'},
  {id:11,subject:'Citizenship & Civic Duty',question:'A good citizen is best described as one who:',choices:['Pays taxes only','Obeys laws and contributes to society','Avoids politics','Prioritizes personal interests'],answer:1,explanation:"A good citizen obeys laws, participates in civic life, and works for the common good."},
  {id:12,subject:'Citizenship & Civic Duty',question:'Primary prevention in civic life means:',choices:['Reacting to problems','Preventing issues before they occur','Treating social issues','Rehabilitation programs'],answer:1,explanation:"Prevention-focused civic engagement aims to stop problems before they arise through education and community action."},
  {id:13,subject:'Character Education',question:'Integrity means:',choices:['Being smart academically','Acting with honesty even when no one is watching','Following rules only when enforced','Being popular among peers'],answer:1,explanation:"Integrity means adhering to moral principles consistently ‚Äî doing what is right even when unobserved."},
  {id:14,subject:'Character Education',question:'Empathy is best defined as:',choices:['Feeling sorry for someone','Understanding and sharing the feelings of another','Giving money to the poor','Offering advice to others'],answer:1,explanation:"Empathy is the ability to understand and share another person's feelings ‚Äî putting yourself in their shoes."},
  {id:15,subject:'Social Responsibility',question:'Environmental stewardship means:',choices:['Using all natural resources freely','Taking care of and protecting the environment','Prioritizing economic gain over nature','Leaving environmental issues to government'],answer:1,explanation:"Environmental stewardship is the responsible use and protection of nature through conservation."},
  {id:16,subject:'Social Responsibility',question:"The 'common good' refers to:",choices:['What benefits only the majority','Shared public facilities','Conditions that allow people and communities to flourish','Individual freedom without limits'],answer:2,explanation:"The common good refers to conditions allowing people ‚Äî as individuals or groups ‚Äî to reach their fulfillment."},
];

let nxtId=17, curFlashSubj=null, flashDeck=[], flashIdx=0, isFlipped=false;
let qzQs=[], qzIdx=0, qzScore=0, isAnswered=false, qzTimer=null, qzTimerSecs=0;
let stats={correct:0,attempted:0,flashReviewed:0}, scores=[], importedFiles=[];

const shuf=a=>{const b=[...a];for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];}return b;};

// ‚ïê‚ïê‚ïê NAVIGATION ‚ïê‚ïê‚ïê
function go(page){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('on'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('pg-'+page).classList.add('on');
  const nb=document.querySelector(`[data-page="${page}"]`);
  if(nb)nb.classList.add('active');
  if(page==='dashboard')renderDash();
  if(page==='subjects')renderSubjects();
  if(page==='flashcards')initFlash();
  if(page==='quiz')initQuizSetup();
  if(page==='scores')renderScores();
  if(page==='add')renderAddPage();
}

// ‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê
function renderDash(){
  document.getElementById('st-total').textContent=Q.length;
  document.getElementById('st-correct').textContent=stats.correct;
  document.getElementById('st-acc').textContent=stats.attempted>0?Math.round((stats.correct/stats.attempted)*100)+'%':'‚Äî';
  document.getElementById('st-flash').textContent=stats.flashReviewed;
  document.getElementById('db-topics').innerHTML=SUBJECTS.map(s=>`
    <div onclick="curFlashSubj='${s.name}';go('flashcards')" style="display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--surface2);border-radius:8px;cursor:pointer;border:1px solid var(--border);transition:all .15s" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='var(--border)'">
      <span style="font-size:17px">${s.icon}</span>
      <div style="flex:1;font-size:12px;font-weight:600">${s.name}</div>
      <span class="chip">${Q.filter(q=>q.subject===s.name).length} Q</span>
    </div>`).join('');
}

// ‚ïê‚ïê‚ïê SUBJECTS ‚ïê‚ïê‚ïê
function renderSubjects(){
  document.getElementById('subjects-grid').innerHTML=SUBJECTS.map(s=>{
    const c=Q.filter(q=>q.subject===s.name).length;
    return`<div class="subj-card" onclick="curFlashSubj='${s.name}';go('flashcards')">
      <div class="subj-icon">${s.icon}</div>
      <div class="subj-name">${s.name}</div>
      <div class="subj-count">${c} question${c!==1?'s':''}</div>
      <div class="prog-bg"><div class="prog-fill" style="width:${Math.min(c*7,100)}%;background:${s.color}"></div></div>
      <div style="display:flex;justify-content:space-between;font-size:10px;color:var(--muted2);margin-top:5px"><span>${c} Qs</span><span>Study ‚Üí</span></div>
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê FLASHCARDS ‚ïê‚ïê‚ïê
function initFlash(){
  const pills=['All',...SUBJECTS.map(s=>s.name)];
  document.getElementById('fc-pills').innerHTML=pills.map(n=>`
    <button class="pill ${(curFlashSubj===n||(n==='All'&&!curFlashSubj))?'on':''}"
      onclick="curFlashSubj='${n==='All'?'':n}';document.querySelectorAll('#fc-pills .pill').forEach(p=>p.classList.remove('on'));this.classList.add('on');loadFlash()">${n}</button>`).join('');
  loadFlash();
}

function loadFlash(){
  flashDeck=curFlashSubj?shuf(Q.filter(q=>q.subject===curFlashSubj)):shuf([...Q]);
  flashIdx=0;isFlipped=false;
  document.getElementById('fc-inner').classList.remove('flipped');
  document.getElementById('rate-area').style.display='none';
  updateFlashcard();
}

function updateFlashcard(){
  if(!flashDeck.length){
    document.getElementById('fc-q').textContent='No questions in this subject yet. Import a file or add questions!';
    document.getElementById('fc-a').textContent='‚Äî';
    document.getElementById('fc-count').textContent='0 / 0';
    return;
  }
  const q=flashDeck[flashIdx];
  document.getElementById('fc-q').textContent=q.question;
  document.getElementById('fc-a').textContent=q.choices[q.answer];
  const expEl=document.getElementById('fc-exp');
  if(q.explanation){expEl.textContent=q.explanation;expEl.style.display='block';}
  else expEl.style.display='none';
  document.getElementById('fc-count').textContent=(flashIdx+1)+' / '+flashDeck.length;
  document.getElementById('fc-prev').disabled=flashIdx===0;
  document.getElementById('fc-next').disabled=flashIdx===flashDeck.length-1;
  document.getElementById('fc-inner').classList.remove('flipped');
  isFlipped=false;
  document.getElementById('rate-area').style.display='none';
}

function flipCard(){
  isFlipped=!isFlipped;
  document.getElementById('fc-inner').classList.toggle('flipped',isFlipped);
  if(isFlipped){document.getElementById('rate-area').style.display='block';stats.flashReviewed++;}
  else document.getElementById('rate-area').style.display='none';
}

function fcPrev(){if(flashIdx>0){flashIdx--;updateFlashcard();}}
function fcNext(){if(flashIdx<flashDeck.length-1){flashIdx++;updateFlashcard();}}

function rateCard(r){
  toast(r==='easy'?'üòÑ Easy! Great job!':r==='ok'?'üòê OK, keep at it!':'üòì Mark for review ‚Äî practice more');
  if(flashIdx<flashDeck.length-1)fcNext();else toast('üéâ Deck complete!');
}

// ‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê
function initQuizSetup(){
  clearQTimer();
  document.getElementById('quiz-setup').style.display='block';
  document.getElementById('quiz-active').style.display='none';
  document.getElementById('qz-subj').innerHTML='<option value="all">üåê All Subjects (Mixed)</option>'+
    SUBJECTS.map(s=>`<option value="${s.name}">${s.icon} ${s.name}</option>`).join('');
}

function startQuiz(){
  const subj=document.getElementById('qz-subj').value;
  const numQ=document.getElementById('qz-num').value;
  qzTimerSecs=parseInt(document.getElementById('qz-timer').value);
  let pool=subj==='all'?[...Q]:Q.filter(q=>q.subject===subj);
  pool=shuf(pool);
  const num=numQ==='all'?pool.length:Math.min(parseInt(numQ),pool.length);
  if(!pool.length){toast('No questions available for this subject!');return;}
  qzQs=pool.slice(0,num);qzIdx=0;qzScore=0;isAnswered=false;
  document.getElementById('quiz-setup').style.display='none';
  document.getElementById('quiz-active').style.display='block';
  renderQ();
}

function renderQ(){
  const q=qzQs[qzIdx];const tot=qzQs.length;
  isAnswered=false;
  document.getElementById('next-btn').style.display='none';
  document.getElementById('expl-box').classList.remove('on');
  document.getElementById('qpf').style.width=Math.round((qzIdx/tot)*100)+'%';
  document.getElementById('qpl').textContent='Question '+(qzIdx+1)+' of '+tot;
  document.getElementById('q-num').textContent='Question '+(qzIdx+1);
  document.getElementById('q-text').textContent=q.question;
  const L=['A','B','C','D'];
  document.getElementById('choices-grid').innerHTML=q.choices.map((c,i)=>`
    <button class="choice-btn" onclick="pickChoice(${i})">
      <div class="choice-letter">${L[i]}</div><span>${c}</span>
    </button>`).join('');
  clearQTimer();
  const tp=document.getElementById('timer-pill');
  if(qzTimerSecs>0){
    tp.style.display='block';tp.className='timer-pill';
    let s=qzTimerSecs;document.getElementById('timer-v').textContent=s;
    qzTimer=setInterval(()=>{
      s--;document.getElementById('timer-v').textContent=s;
      if(s<=10)tp.className='timer-pill danger';else if(s<=20)tp.className='timer-pill warn';
      if(s<=0){clearQTimer();autoFail();}
    },1000);
  }else tp.style.display='none';
}

function pickChoice(idx){
  if(isAnswered)return;
  isAnswered=true;clearQTimer();
  const q=qzQs[qzIdx];
  document.querySelectorAll('.choice-btn').forEach((b,i)=>{
    b.disabled=true;
    if(i===q.answer)b.classList.add('correct');
    else if(i===idx&&idx!==q.answer)b.classList.add('wrong');
  });
  if(idx===q.answer){qzScore++;stats.correct++;}
  stats.attempted++;
  if(q.explanation){const eb=document.getElementById('expl-box');eb.textContent='üí° '+q.explanation;eb.classList.add('on');}
  document.getElementById('next-btn').style.display='block';
}

function autoFail(){
  if(!isAnswered){
    isAnswered=true;stats.attempted++;
    const q=qzQs[qzIdx];
    document.querySelectorAll('.choice-btn').forEach((b,i)=>{b.disabled=true;if(i===q.answer)b.classList.add('correct');});
    const eb=document.getElementById('expl-box');
    eb.textContent="‚è± Time's up! "+(q.explanation?'üí° '+q.explanation:'');
    eb.classList.add('on');
    document.getElementById('next-btn').style.display='block';
  }
}

function nextQ(){qzIdx++;if(qzIdx>=qzQs.length)endQuiz();else renderQ();}

function endQuiz(){
  clearQTimer();
  const tot=qzQs.length;const pct=tot>0?Math.round((qzScore/tot)*100):0;
  const result={score:qzScore,total:tot,pct,subject:document.getElementById('qz-subj').value,date:new Date().toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'})};
  scores.unshift(result);
  document.getElementById('res-emoji').textContent=pct>=80?'üéâ':pct>=60?'üòä':'üòì';
  document.getElementById('res-title').textContent=pct>=80?'Excellent Work!':pct>=60?'Good Job!':'Keep Practicing!';
  document.getElementById('ring-pct').textContent=pct+'%';
  document.getElementById('rs-cor').textContent=qzScore;
  document.getElementById('rs-wro').textContent=tot-qzScore;
  document.getElementById('rs-tot').textContent=tot;
  const col=pct>=80?'#059669':pct>=60?'#D97706':'#DC2626';
  document.getElementById('score-ring').style.background=`conic-gradient(${col} ${pct}%,#E4E6F0 0%)`;
  document.getElementById('result-overlay').classList.add('on');
  document.getElementById('quiz-setup').style.display='block';
  document.getElementById('quiz-active').style.display='none';
}

function closeResult(){document.getElementById('result-overlay').classList.remove('on');}
function clearQTimer(){if(qzTimer){clearInterval(qzTimer);qzTimer=null;}}

// ‚ïê‚ïê‚ïê SCORES ‚ïê‚ïê‚ïê
function renderScores(){
  document.getElementById('sc-att').textContent=stats.attempted;
  document.getElementById('sc-cor').textContent=stats.correct;
  const acc=stats.attempted>0?Math.round((stats.correct/stats.attempted)*100)+'%':'‚Äî';
  const el=document.getElementById('sc-acc');
  el.textContent=acc;
  el.style.color=stats.attempted===0?'var(--muted2)':parseInt(acc)>=75?'var(--green)':'var(--red)';
  const hw=document.getElementById('history-wrap');
  if(!scores.length){
    hw.innerHTML='<div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-t">No quiz results yet</div><div class="empty-s">Complete a quiz to see your scores here</div></div>';
    return;
  }
  hw.innerHTML=`<div style="font-size:15px;font-weight:700;margin-bottom:12px">üèÜ Quiz History</div>
  <div class="history-list">${scores.map((s,i)=>{
    const cls=s.pct>=80?'hi':s.pct>=60?'mid':'lo';
    const col=s.pct>=80?'var(--green)':s.pct>=60?'var(--amber)':'var(--red)';
    return`<div class="history-item">
      <div class="hist-rank ${cls}">#${i+1}</div>
      <div class="hist-info">
        <div class="hist-title">${s.subject==='all'?'üåê Mixed Subjects':s.subject} Quiz</div>
        <div class="hist-meta">${s.score}/${s.total} correct ¬∑ ${s.date}</div>
      </div>
      <div class="hist-pct" style="color:${col}">${s.pct}%</div>
    </div>`;
  }).join('')}</div>`;
}

// ‚ïê‚ïê‚ïê ADD QUESTION ‚ïê‚ïê‚ïê
function renderAddPage(){
  document.getElementById('nq-s').innerHTML=SUBJECTS.map(s=>`<option value="${s.name}">${s.icon} ${s.name}</option>`).join('');
  document.getElementById('q-badge').textContent=Q.length;
  const list=document.getElementById('q-list');
  if(!Q.length){list.innerHTML='<div class="empty-state" style="padding:32px"><div class="empty-icon" style="font-size:32px">üì≠</div><div class="empty-t">No questions yet</div></div>';return;}
  list.innerHTML=[...Q].reverse().map(q=>`
    <div class="q-item">
      <div class="q-item-t">
        <div class="q-item-q">${q.question.substring(0,60)}${q.question.length>60?'‚Ä¶':''}</div>
        <div class="q-item-m">üìÇ ${q.subject} ¬∑ ‚úÖ ${q.choices[q.answer]}</div>
      </div>
      <button class="del-btn" onclick="delQ(${q.id})">‚úï</button>
    </div>`).join('');
}

function addQ(){
  const s=document.getElementById('nq-s').value;
  const question=document.getElementById('nq-q').value.trim();
  const a=document.getElementById('nq-a').value.trim();
  const b=document.getElementById('nq-b').value.trim();
  const c=document.getElementById('nq-c').value.trim();
  const d=document.getElementById('nq-d').value.trim();
  const ans=document.getElementById('nq-ans').value;
  const exp=document.getElementById('nq-exp').value.trim();
  if(!question||!a||!b||!c||!d){toast('‚ö†Ô∏è Please fill in all fields!');return;}
  Q.push({id:nxtId++,subject:s,question,choices:[a,b,c,d],answer:{A:0,B:1,C:2,D:3}[ans],explanation:exp});
  document.getElementById('nq-q').value='';
  ['nq-a','nq-b','nq-c','nq-d','nq-exp'].forEach(id=>document.getElementById(id).value='');
  renderAddPage();
  toast('‚úÖ Question added!');
}

function delQ(id){Q=Q.filter(q=>q.id!==id);renderAddPage();toast('üóëÔ∏è Question deleted');}

// ‚ïê‚ïê‚ïê FILE IMPORT ‚ïê‚ïê‚ïê
function handleDrop(e){
  e.preventDefault();
  document.getElementById('import-dropzone').classList.remove('drag');
  handleFiles(e.dataTransfer.files);
}

function handleFiles(files){
  for(const file of files){
    if(file.type==='application/pdf')processPDF(file);
    else if(file.type==='text/plain'||file.name.endsWith('.txt')||file.name.endsWith('.md'))processTXT(file);
    else toast('‚ö†Ô∏è Unsupported format. Use PDF or TXT.');
  }
}

async function processPDF(file){
  const item={name:file.name,type:'PDF',status:'processing',count:0};
  importedFiles.push(item);
  updateImportedList();
  showProc('Reading PDF: '+file.name,'Extracting text from pages‚Ä¶',0);

  try{
    const arrayBuffer=await file.arrayBuffer();
    const pdf=await pdfjsLib.getDocument({data:arrayBuffer}).promise;
    let fullText='';
    for(let i=1;i<=pdf.numPages;i++){
      const page=await pdf.getPage(i);
      const tc=await page.getTextContent();
      fullText+=tc.items.map(it=>it.str).join(' ')+'\n';
      setProc(Math.round((i/pdf.numPages)*40),'Reading page '+i+' of '+pdf.numPages+'‚Ä¶');
    }
    item.pageCount=pdf.numPages;
    setProc(40,'Text extracted. Sending to AI‚Ä¶');
    await extractWithAI(fullText, item, document.getElementById('paste-subject').value);
  }catch(err){
    item.status='error';
    updateImportedList();
    hideProc();
    toast('‚ùå Error reading PDF: '+err.message);
  }
}

async function processTXT(file){
  const item={name:file.name,type:'TXT',status:'processing',count:0};
  importedFiles.push(item);
  updateImportedList();
  showProc('Reading file: '+file.name,'Extracting text‚Ä¶',10);
  const text=await file.text();
  setProc(40,'Text extracted. Sending to AI‚Ä¶');
  await extractWithAI(text, item, document.getElementById('paste-subject').value);
}

async function processPastedText(){
  const text=document.getElementById('paste-text').value.trim();
  const subject=document.getElementById('paste-subject').value;
  if(!text){toast('‚ö†Ô∏è Please paste some text first!');return;}
  const item={name:'Pasted Text ('+subject+')',type:'TEXT',status:'processing',count:0};
  importedFiles.push(item);
  updateImportedList();
  showProc('Processing pasted text‚Ä¶','Sending to AI for analysis‚Ä¶',30);
  await extractWithAI(text,item,subject);
  document.getElementById('paste-text').value='';
}

async function extractWithAI(text, item, defaultSubject){
  setProc(50,'AI is analyzing content‚Ä¶','Identifying questions, choices, and answers');
  updateStep(0,'done');updateStep(1,'active');

  const prompt=`You are an expert at extracting exam questions from study materials.

From the text below, extract ALL multiple-choice questions you can find OR generate high-quality multiple-choice questions based on the key concepts, facts, and topics in the text.

IMPORTANT RULES:
- Each question must have exactly 4 choices (A, B, C, D)
- Identify or determine the correct answer
- Add a brief explanation for each answer
- Subject should be one of: Ethics & Morality, Filipino Values, Human Rights, Citizenship & Civic Duty, Character Education, Social Responsibility, General Values Education
- If the text already has questions, extract them. If not, CREATE questions from the content.
- Generate at least 5 questions, up to 20 maximum.
- Make questions clear and educational.

Return ONLY valid JSON array, no other text, no markdown, no backticks:
[
  {
    "subject": "Ethics & Morality",
    "question": "Question text here?",
    "choices": ["Choice A", "Choice B", "Choice C", "Choice D"],
    "answer": 0,
    "explanation": "Brief explanation of the correct answer."
  }
]

The answer field is the 0-based index of the correct choice (0=A, 1=B, 2=C, 3=D).

TEXT TO ANALYZE:
${text.substring(0,8000)}`;

  try{
    setProc(60,'AI is reading your content‚Ä¶','This may take a few seconds');
    updateStep(1,'done');updateStep(2,'active');

    const apiKey=document.getElementById('api-key-input').value.trim();
    if(!apiKey){throw new Error('Please enter your Anthropic API key above before importing.');}
    const response=await fetch('https://api.anthropic.com/v1/messages',{
      method:'POST',
      headers:{
        'Content-Type':'application/json',
        'x-api-key':apiKey,
        'anthropic-version':'2023-06-01',
        'anthropic-dangerous-direct-browser-access':'true'
      },
      body:JSON.stringify({
        model:'claude-haiku-4-5-20251001',
        max_tokens:4000,
        system:'You extract or generate exam questions from text. Always return only valid JSON array.',
        messages:[{role:'user',content:prompt}]
      })
    });

    setProc(80,'Processing AI response‚Ä¶','Importing questions into your library');
    updateStep(2,'done');updateStep(3,'active');

    const data=await response.json();
    if(data.error){throw new Error(data.error.message);}

    const raw=data.content[0].text;
    let parsed;
    try{
      // Try to find JSON array in response
      const match=raw.match(/\[[\s\S]*\]/);
      parsed=JSON.parse(match?match[0]:raw);
    }catch(e){
      throw new Error('AI response could not be parsed as JSON.');
    }

    if(!Array.isArray(parsed)||!parsed.length){throw new Error('No questions found in AI response.');}

    let count=0;
    for(const q of parsed){
      if(q.question&&Array.isArray(q.choices)&&q.choices.length===4&&typeof q.answer==='number'){
        Q.push({
          id:nxtId++,
          subject:q.subject||defaultSubject,
          question:q.question,
          choices:q.choices,
          answer:Math.min(Math.max(q.answer,0),3),
          explanation:q.explanation||''
        });
        count++;
      }
    }

    item.status='done';
    item.count=count;
    setProc(100,'Done! '+count+' questions imported','Added to your question bank');
    updateStep(3,'done');

    setTimeout(()=>{
      hideProc();
      updateImportedList();
      renderDash();
      toast('‚úÖ '+count+' questions imported from '+item.name+'!');
    },1200);

  }catch(err){
    item.status='error';
    item.error=err.message;
    updateImportedList();
    hideProc();
    toast('‚ùå AI error: '+err.message.substring(0,80));
  }
}

// ‚îÄ‚îÄ PROC UI ‚îÄ‚îÄ
let procSteps=['Extract text','Analyze content','Generate questions','Import to library'];

function showProc(title,sub,pct){
  document.getElementById('processing-wrap').style.display='block';
  document.getElementById('proc-title').textContent=title;
  document.getElementById('proc-sub').textContent=sub;
  document.getElementById('proc-bar').style.width=pct+'%';
  document.getElementById('proc-pct').textContent=pct+'%';
  document.getElementById('proc-steps').innerHTML=procSteps.map((s,i)=>`
    <div class="step">
      <div class="step-dot ${i===0?'active':'pending'}"></div>
      <span style="color:${i===0?'var(--accent)':'var(--muted2)'}">${s}</span>
    </div>`).join('');
}

function setProc(pct,title,sub){
  document.getElementById('proc-bar').style.width=pct+'%';
  document.getElementById('proc-pct').textContent=pct+'%';
  if(title)document.getElementById('proc-title').textContent=title;
  if(sub)document.getElementById('proc-sub').textContent=sub;
}

function updateStep(idx,state){
  const dots=document.querySelectorAll('.step-dot');
  const labels=document.querySelectorAll('.step span');
  if(dots[idx]){
    dots[idx].className='step-dot '+state;
    if(labels[idx])labels[idx].style.color=state==='done'?'var(--green)':state==='active'?'var(--accent)':'var(--muted2)';
  }
}

function hideProc(){document.getElementById('processing-wrap').style.display='none';}

function updateImportedList(){
  const wrap=document.getElementById('imported-wrap');
  const list=document.getElementById('imported-list');
  if(!importedFiles.length){wrap.style.display='none';return;}
  wrap.style.display='block';
  list.innerHTML=importedFiles.map(f=>{
    const statusBadge=f.status==='done'?`<span class="import-item-badge badge-done">‚úÖ ${f.count} questions</span>`:
      f.status==='error'?`<span class="import-item-badge badge-err">‚ùå Error</span>`:
      `<span class="import-item-badge badge-process">‚è≥ Processing‚Ä¶</span>`;
    const icon=f.type==='PDF'?'üìÑ':f.type==='TXT'?'üìù':'‚úçÔ∏è';
    return`<div class="import-item">
      <div class="import-item-icon">${icon}</div>
      <div class="import-item-info">
        <div class="import-item-name">${f.name}</div>
        <div class="import-item-meta">${f.type}${f.pageCount?' ¬∑ '+f.pageCount+' pages':''}</div>
      </div>
      ${statusBadge}
    </div>`;
  }).join('');
}

// ‚ïê‚ïê‚ïê TOAST ‚ïê‚ïê‚ïê
let toastTO;
function toast(msg){
  const el=document.getElementById('toast-el');
  document.getElementById('toast-msg').textContent=msg;
  el.classList.add('on');
  clearTimeout(toastTO);
  toastTO=setTimeout(()=>el.classList.remove('on'),3500);
}

// ‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê
renderDash();
</script>
</body>
</html>
